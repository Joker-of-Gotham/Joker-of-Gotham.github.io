---
layout: post
title: "机器学习与算法交易(四): 更复杂的机器学习与量化模型"
date: 2025-08-13
categories: [金融分析, 人工智能, 机器学习]
tags: [综述笔记, 金融量化]
published: true
mermaid: true
math: true
toc: true
---

# ⽤于波动率预测和统计套利的时间序列模型

本部分，我们将构建动态线性模型，以明确表示时间，并纳⼊在特定时间间隔或滞后期观测到的变量。时间序列数据的⼀个关键特征是其序列顺序：我们的数据不是像横截⾯数据那样的单个观测值的随机样本，⽽是⼀个我们⽆法重复的随机过程的单次实现。我们的⽬标是识别时间序列中的系统性模式，以帮助我们预测该时间序列未来的⾏为。

## 用于诊断和特征提取的工具

时间序列有一系列离散数值组成，可以被建模为一组随机过程：

$$t_i \to y(t_i) \ for \ \{ t_i \| i=1,\cdots,T \}$$

在不同时间点$t_{i'}t_{j'}$之间的周期数$\Delta t=t_i-t_j$称为滞后，每个时间序列有T-1个不同的滞后。在该背景下，滞后值序列$\{ y_{t-1},\cdots,y_{t_{T}} \}$一起作为输入。

如果一个时间序列是一系列独立同分布(IID)的随机变量$\epsilon_{t}$，且具有有限的均值和方差，则它被称为白噪声。特别的，如果这些随机变量服从均值为0，恒定方差为$\sigma$的正态分布，该序列被称为白噪声。

如果一个时间序列写成过去的扰动项$\epsilon_t$和序列均值$\mu$的加权和，则其为线性的：

$$y_t=\mu+\sum\limits_{i=0}^{\infty}a_{i}\epsilon_{t-i},a_0=1,\epsilon \sim i.i.d$$

时间序列分析的⼀个关键⽬标是理解由系数$a_i$驱动的动态⾏为。时间序列分析提供了针对此类数据的⽅法，旨在提取有⽤的模式，进⽽帮助我们构建预测模型。

### 时间序列模式的分解

时间序列数据通常包含多种模式的混合，这些模式可以分解为⼏个组成部分。具体来说，⼀个时间序列常常将趋势、季节性和周期等系统性成分与⾮系统性的噪声结合在⼀起。这些成分可以建模为线性组合（例如，当波动不依赖于序列的⽔平时），也可以建模为⾮线性的乘法形式。

### 滚动窗⼝统计与移动平均

鉴于时间序列数据的顺序性，为给定⻓度的周期计算常⻅的描述性统计数据是很⾃然的做法。其⽬标是检测序列是稳定还是随时间变化，并获得⼀个平滑的表示，在滤除噪声的同时捕捉系统性特征。

滚动窗⼝统计服务于这⼀过程：它们⽣成⼀个新的时间序列，其中每个数据点都代表了为原始数据某个周期计算的汇总统计量。移动平均是最常⻅的例⼦。原始数据点可以以相等的权重参与计算，也可以（例如）赋予近期数据点更⾼的权重。指数移动平均会递归地计算权重，这些权重会随着数据点在时间上的推移⽽衰减。新的数据点通常是所有先前数据点的汇总，但也可以根据⼀个围绕的窗⼝来计算。

早期的预测模型包括带有指数权重的移动平均模型，称为指数平滑模型。我们将在后⾯再次遇到移动平均，它是线性时间序列的关键构建模块。依赖指数平滑⽅法的预测使⽤的是过去观测值的加权平均，其中权重会随着观测值变旧⽽呈指数级衰减。因此，越近的观测值获得的权重越⾼。这些⽅法在没有⾮常复杂或突变模式的时间序列中很受欢迎。

### 自相关性的衡量

自相关性系数$\rho_{k}$衡量的是由给定滞后期$k$分隔的时间序列值之间的线性关系程度：

$$\rho_{k}=\frac{\sum\limits_{t=k+1}^{T}(y_t-\bar{y})(y_{t-k}-\bar{y})}{\sum\limits_{t=1}^{T}(y_t -\bar{y})^{2}}$$

因此，对于一个长度为$T$的时间序列，我们可以为其$T-1$个滞后期中的每一个计算一个自相关系数。自相关函数(ACF)滞后期大于1(即相隔超过一个时间步的观测值之间)的自相关，即反映了这些观测值之间的直接相关性，也反映了中间数据点的间接影响；偏⾃相关则移除了这种影响。还有⼀些算法可以根据偏⾃相关函数（PACF）和⾃相关函数（ACF）之间确切的理论关系，从样本⾃相关中估算出偏⾃相关。

### 如何诊断并实现平稳性

平稳时间序列的统计特性，如均值、⽅差或⾃相关，都与时间段⽆关，没有趋势或季节性效应；此外，描述性统计量在针对不同滚动窗⼝计算时，是恒定的或不随时间发⽣显著变化。平稳时间序列会回归其均值，其偏差具有恒定的振幅，⽽短期波动在统计意义上总是相似的。

更正式地说，严平稳性要求时间序列观测值任何⼦集的联合分布在所有矩上都与时间⽆关。因此，除了均值和⽅差，更⾼阶的矩（如偏度和峰度）也需要保持恒定，⽆论不同观测值之间的滞后如何。

#### 转换时间序列以实现平稳性

为了满⾜许多时间序列模型的平稳性假设，我们需要对原始序列进⾏转换，这通常需要⼏个步骤。常⻅的转换⽅法包括使⽤(⾃然)对数将指数增⻓模式转换为线性趋势并稳定⽅差。

缩减（Deflation）是指将⼀个时间序列除以另⼀个导致趋势⾏为的序列，例如，将名义序列除以价格指数，以将其转换为实际度量。如果⼀个序列能够回归到稳定的⻓期线性趋势，那么它就是趋势平稳的。通常可以通过线性回归拟合趋势线并使⽤残差来使其平稳。这意味着将时间索引作为⾃变量纳⼊线性回归模型，并可能结合对数转换或平减处理。

在许多情况下，仅去除趋势并不⾜以使序列平稳。相反，我们需要将原始数据转换为⼀个周期与周期之间和/或季节与季节之间差异的序列。换句话说，我们使⽤相邻数据点或季节性滞后值相互减法的结果。请注意，当这种差分应⽤于经过对数转换的序列时，其结果在⾦融背景下代表瞬时增⻓率或回报率。

> **单位根和随机游走**  
> 在时间序列建模中，存在单位根会导致序列非平稳（如随机游走），常需通过差分（包括一阶差分和季节性差分）来实现平稳化。单位根可用ADF 检验等统计方法诊断，检验结果指导差分次数和滞后阶数的选择。除了整数阶差分，还可用分数阶差分保留更多长期信息。并提供了基于自相关特征判断是否需差分及是否过度差分的经验法则。
{: .prompt-info }

## 单变量时间序列模型

单变量时间序列模型将时间序列的当前值与该序列的滞后值、当前噪声以及可能存在的过去噪声项的线性组合关联起来。

### 构建自回归模型

一个$p$阶的AR模型旨在捕捉时间序列在不同滞后期的值之间的线性依赖关系，可写成如下形式：

$$AR(p):y_t=\phi_0+\epsilon_t+\sum\limits_{i=1}^{p}\phi_i y_{t-i}$$

该模型具有特征方程：

$$1-\sum\limits_{i=1}^{p}x^{i}=0$$

该方程解的倒数就是特征根，如果所有根的绝对值小于1，则$AR(p)$平稳，否则不平稳。对于平稳序列，多步预测将收敛于序列的均值。

### 确定模型阶数

在实践中，挑战在于确定滞后项的合适阶数p，ACF估算的是不同滞后阶数观测值之间的自相关性，⽽这种⾃相关性是由直接和间接的线性依赖关系共同导致的。如果⼀个k阶的AR模型是正确的模型，那么ACF将显示出直到滞后k阶的显著序列相关性，并且由于线性关系的间接影响所产⽣的惯性，这种相关性会延伸到后续的滞后阶数，直到影响减弱并最终逐渐消失。⽽PACF只衡量给定滞后间隔的观测值之间的直接线性关系，因此它不会反映出超过k阶的滞后相关性。

### 诊断模型拟合

如果模型恰当地捕捉了不同滞后阶之间的线性依赖关系，那么残差应类似于⽩噪声，并且⾃相关函数（ACF）图应凸显出不存在显著的⾃相关系数。

Ljung-Box Q 统计量也让我们能够检验残差序列是否服从⽩噪声的假设。其原假设是所有$m$序列的相关系数为0，备择假设为一些系数非0，该检验统计量根据不同滞后阶$k$的样本自相关系数$\rho_{k}$计算得出，并服从分布：

$$Q(m)=T(T+2)\sum\limits_{t=1}^{m}\frac{\rho_{l}^{2}}{T-l}$$

### 构建移动平均模型

$MA(q)$模型在⼀个类似回归的模型中使⽤$q$个过去的扰动项，⽽不是时间序列的滞后值，其形式如下：

$$MA(q):y_t=c+\epsilon_t+\sum\limits_{i=1}^{p}\theta_i \epsilon_{t-i},\epsilon \sim i.i.d$$

### 确定滞后阶数

由$ MA(q) $过程⽣成的时间序列是由先前$q$个模型预测的残差驱动的。因此，$MA(q) $过程的⾃相关函数(ACF)将在滞后阶数达到$log \ q$之前显示出显著的系数，然后急剧下降，因为模型就是这样假设序列值⽣成的。

### AR 模型与 MA 模型之间的关系

一个$AR(p)$模型总能通过重复代换表示为$MA(\infty)$过程；当$MA(q)$过程的系数满足某些大小约束时，它也变得可逆，并可以表示为$AR(\infty)$过程。⾃回归移动平均（ARIMA）模型结合了 AR(p) 和 MA(q) 过程，以利⽤这些构建模块的互补性，并简化模型开发。它们通过使⽤更紧凑的形式和减少参数数量来实现这⼀点，从⽽降低过拟合的⻛险。

### 对差分序列建模

不进⾏差分的模型假设原始序列是平稳的，包括均值回归。它通常包含⼀个常数项，以允许⾮零均值。进⾏⼀阶差分的模型假设原始序列具有恒定的趋势，因此应包含⼀个常数项。⼀个进⾏⼆阶差分的模型假设原始序列具有时变趋势，因此不应包含常数项。

当然还可以通过ARMAX添加特征或通过SARIMAX加入季节性差分，进一步提升模型效果。进一步的，对模型进行更新，可以得到效果更好的ARCH和GARCH模型预测波动率。

## 多变量时间序列模型

多变量时间序列模型旨在同时捕捉多个时间序列的动态，并利⽤这些序列间的依赖关系来进⾏更可靠的预测。该模型允许其他时间序列的滞后值影响⽬标变量。这种影响适⽤于所有序列，从⽽产⽣复杂的相互作⽤。除了可能提供更好的预测外，多变量时间序列还⽤于深⼊了解序列间的相互依赖关系。

### 向量自回归模型

向量自回归模型在$k$个时间序列和$p$阶下表示为：

$${\bf{y}}_{t}={\bf{c}}+\boldsymbol{\epsilon}_t+\sum\limits_{i=1}^{p}{\bf{A}}_i {\bf{y}}_{t-i}$$

VAR§模型也要求平稳性，因此单变量时间序列建模的初始步骤同样适⽤。如果$k$个序列中的部分或全部是单位根⾮平稳的，它们可能存在协整关系。这个将单位根概念扩展到多个时间序列的含义是，两个或多个序列的线性组合是平稳的，因此具有均值回归特性。

> **协整**  
> 协整就是在多个各自非平稳(I(1))的时间序列中，找出能组合成平稳(I(0))序列的线性关系，目的是避免伪回归并捕捉均值回归机会，可用 Engle–Granger（两步法，适合成对）或 Johansen（适合多变量）检验来计算，常用于统计套利、配对交易等量化策略中，以价差偏离均值时建仓、回归均值时平仓。
{: .prompt-info }

