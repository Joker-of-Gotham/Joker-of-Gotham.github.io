---
layout: post
title: "å‰ç«¯å¼€å‘æ•´ç†(äº”): Vueæ¡†æ¶çš„ç»„ä»¶é€šä¿¡å’Œå…¨å±€çŠ¶æ€ç®¡ç†"
date: 2025-08-12
categories: [æŠ€æœ¯æ‚è°ˆ]
tags: [æŠ€æœ¯, å‰ç«¯]
published: true
mermaid: true
math: true
toc: true
---

# ç»„ä»¶é—´é€šä¿¡

## çˆ¶å­ç»„ä»¶é€šä¿¡

çˆ¶å­ç»„ä»¶é€šä¿¡æ˜¯æŒ‡ï¼ŒB ç»„ä»¶å¼•å…¥åˆ° A ç»„ä»¶é‡Œæ¸²æŸ“ï¼Œæ­¤æ—¶ A æ˜¯ B çš„çˆ¶çº§ï¼›B ç»„ä»¶çš„ä¸€äº›æ•°æ®éœ€è¦ä» A ç»„ä»¶æ‹¿ï¼ŒB ç»„ä»¶æœ‰æ—¶ä¹Ÿè¦å‘ŠçŸ¥ A ç»„ä»¶ä¸€äº›æ•°æ®å˜åŒ–æƒ…å†µï¼›Child.vue æ˜¯ç›´æ¥æŒ‚è½½åœ¨ Father.vue ä¸‹é¢çš„ã€‚

```bash
# çˆ¶ç»„ä»¶
Father.vue
â”‚ # å­ç»„ä»¶
â””â”€Child.vue
```

å¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š

| **æ–¹æ¡ˆ** | **çˆ¶ç»„ä»¶å‘å­ç»„ä»¶** | **å­ç»„ä»¶å‘çˆ¶ç»„ä»¶** |
| :---: | :---: | :---: |
| props / emits | props | emits |
| v-model / emits | v-model | emits |
| ref / emits | ref | emits |
| provide / inject | provide | inject |
| EventBus | emit / on | emit / on |
| Reactive State | - | - |
| Vuex | - | - |
| Pinia | - | - |

ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä¸‹é¢çš„çˆ¶ç»„ä»¶ç»Ÿä¸€å« Father.vue ï¼Œå­ç»„ä»¶ç»Ÿä¸€å« Child.vue ã€‚

### props / emits

è¿™æ˜¯ Vue è·¨ç»„ä»¶é€šä¿¡æœ€å¸¸ç”¨ï¼Œä¹Ÿæ˜¯åŸºç¡€çš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œå®ƒçš„é€šä¿¡è¿‡ç¨‹æ˜¯ï¼š

1. çˆ¶ç»„ä»¶ Father.vue é€šè¿‡ props å‘å­ç»„ä»¶ Child.vue ä¼ å€¼
2. å­ç»„ä»¶ Child.vue åˆ™å¯ä»¥é€šè¿‡ emits å‘çˆ¶ç»„ä»¶ Father.vue å‘èµ·äº‹ä»¶é€šçŸ¥

æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯ç»Ÿä¸€åœ¨çˆ¶ç»„ä»¶å‘èµ· AJAX è¯·æ±‚ï¼Œæ‹¿åˆ°æ•°æ®åï¼Œå†æ ¹æ®å­ç»„ä»¶çš„æ¸²æŸ“éœ€è¦ä¼ é€’ä¸åŒçš„ props ç»™ä¸åŒçš„å­ç»„ä»¶ä½¿ç”¨ã€‚

#### ä¸‹å‘ props

ä¸‹å‘çš„è¿‡ç¨‹æ˜¯åœ¨ Father.vue é‡Œå®Œæˆçš„ï¼Œçˆ¶ç»„ä»¶åœ¨å‘å­ç»„ä»¶ä¸‹å‘ props ä¹‹å‰ï¼Œéœ€è¦å¯¼å…¥å­ç»„ä»¶å¹¶å¯ç”¨å®ƒä½œä¸ºè‡ªèº«çš„æ¨¡æ¿ï¼Œç„¶ååœ¨ `setup` é‡Œå¤„ç†å¥½æ•°æ®å¹¶ return ç»™ `<template />` ç”¨ã€‚

åœ¨ Father.vue çš„ `<script />` é‡Œï¼š

```ts
// Father.vue
import { defineComponent } from 'vue'
import Child from '@cp/Child.vue'

interface Member {
  id: number
  name: string
}

export default defineComponent({
  // éœ€è¦å¯ç”¨å­ç»„ä»¶ä½œä¸ºæ¨¡æ¿
  components: {
    Child,
  },

  // å®šä¹‰ä¸€äº›æ•°æ®å¹¶ `return` ç»™ `<template />` ç”¨
  setup() {
    const userInfo: Member = {
      id: 1,
      name: 'Petter',
    }

    // ä¸è¦å¿˜è®° `return` ï¼Œå¦åˆ™ `<template />` æ‹¿ä¸åˆ°æ•°æ®
    return {
      userInfo,
    }
  },
})
```

ç„¶ååœ¨ Father.vue çš„ `<template />` è¿™è¾¹æ‹¿åˆ° return å‡ºæ¥çš„æ•°æ®ï¼ŒæŠŠè¦ä¼ é€’çš„æ•°æ®é€šè¿‡å±æ€§çš„æ–¹å¼ç»‘å®šåœ¨ç»„ä»¶æ ‡ç­¾ä¸Šï¼š

```vue
<!-- Father.vue -->
<template>
  <Child
    title="ç”¨æˆ·ä¿¡æ¯"
    :index="1"
    :uid="userInfo.id"
    :user-name="userInfo.name"
  />
</template>
```

åœ¨Â `<template />`Â ç»‘å®šå±æ€§è¿™é‡Œï¼Œå¦‚æœæ˜¯æ™®é€šçš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ä¸Šé¢çš„Â `title`ï¼Œåˆ™ç›´æ¥ç»™å±æ€§åèµ‹å€¼å°±å¯ä»¥ã€‚å¦‚æœæ˜¯å˜é‡åï¼Œæˆ–è€…å…¶ä»–ç±»å‹å¦‚Â `number`Â ã€Â `boolean`Â ç­‰ï¼Œæ¯”å¦‚ä¸Šé¢çš„Â `index`ï¼Œåˆ™éœ€è¦é€šè¿‡å±æ€§åŠ¨æ€ç»‘å®šçš„æ–¹å¼æ¥æ·»åŠ ï¼Œä½¿ç”¨Â `v-bind:`Â æˆ–è€…Â `:`Â ç¬¦å·è¿›è¡Œç»‘å®šã€‚

è¿™æ ·å°±å®Œæˆäº† props æ•°æ®çš„ä¸‹å‘ã€‚

#### æ¥æ”¶ props

æ¥æ”¶çš„è¿‡ç¨‹æ˜¯åœ¨ Child.vue é‡Œå®Œæˆçš„ï¼Œåœ¨Â `<script />`Â éƒ¨åˆ†ï¼Œå­ç»„ä»¶é€šè¿‡ä¸Â `setup`Â åŒçº§çš„ props æ¥æ¥æ”¶æ•°æ®ã€‚

å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªÂ `string[]`Â æ•°ç»„ï¼ŒæŠŠè¦æ¥å—çš„å˜é‡åæ”¾åˆ°è¿™ä¸ªæ•°ç»„é‡Œï¼Œç›´æ¥æ”¾è¿›æ¥ä½œä¸ºæ•°ç»„çš„Â `item`Â ï¼š

```ts
// Child.vue
export default defineComponent({
  props: ['title', 'index', 'userName', 'uid'],
})
```

ä½†è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨è€…ä¸çŸ¥é“è¿™äº›å±æ€§çš„ä½¿ç”¨é™åˆ¶ï¼Œä¾‹å¦‚æ˜¯ä»€ä¹ˆç±»å‹çš„å€¼ã€æ˜¯å¦å¿…ä¼ ç­‰ç­‰ã€‚

#### å¸¦æœ‰ç±»å‹é™åˆ¶çš„ props

å’Œ TypeScript ä¸€æ ·ï¼Œç±»å‹é™åˆ¶å¯ä»¥ä¸ºç¨‹åºå¸¦æ¥æ›´å¥½çš„å¥å£®æ€§ï¼Œ Vue çš„ props ä¹Ÿæ”¯æŒå¢åŠ ç±»å‹é™åˆ¶ã€‚

ç›¸å¯¹äºä¼ é€’ä¸€ä¸ªÂ `string[]`Â ç±»å‹çš„æ•°ç»„ï¼Œæ›´æ¨èçš„æ–¹å¼æ˜¯æŠŠ props å®šä¹‰ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»¥å¯¹è±¡å½¢å¼åˆ—å‡ºï¼Œæ¯ä¸ª Property çš„åç§°å’Œå€¼åˆ†åˆ«æ˜¯å„è‡ªçš„åç§°å’Œç±»å‹ï¼Œåªæœ‰åˆæ³•çš„ç±»å‹æ‰å…è®¸ä¼ å…¥ã€‚

æ”¯æŒçš„ç±»å‹æœ‰ï¼š

| **ç±»å‹** | **å«ä¹‰** |
| :---: | --- |
| String | å­—ç¬¦ä¸² |
| Number | æ•°å€¼ |
| Boolean | å¸ƒå°”å€¼ |
| Array | æ•°ç»„ |
| Object | å¯¹è±¡ |
| Date | æ—¥æœŸæ•°æ®ï¼Œe.g.Â `new Date()` |
| Function | å‡½æ•°ï¼Œe.g. æ™®é€šå‡½æ•°ã€ç®­å¤´å‡½æ•°ã€æ„é€ å‡½æ•° |
| Promise | Promise ç±»å‹çš„å‡½æ•° |
| Symbol | Symbol ç±»å‹çš„å€¼ |

ç»™ props åŠ ä¸Šç±»å‹é™åˆ¶çš„ç¤ºä¾‹ä»£ç ä¸ºï¼š

```ts
// Child.vue
export default defineComponent({
  props: {
    title: String,
    index: Number,
    userName: String,
    uid: Number,
  },
})
```

å¦‚æœéœ€è¦å¯¹æŸä¸ª Prop å…è®¸å¤šç±»å‹ï¼Œæ¯”å¦‚è¿™ä¸ª `uid` å­—æ®µï¼Œå¯èƒ½æ˜¯æ•°å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç±»å‹è¿™é‡Œï¼Œä½¿ç”¨ä¸€ä¸ªæ•°ç»„ï¼ŒæŠŠå…è®¸çš„ç±»å‹éƒ½åŠ è¿›å»:

```ts
// Child.vue
export default defineComponent({
  props: {
    // å•ç±»å‹
    title: String,
    index: Number,
    userName: String,

    // è¿™é‡Œä½¿ç”¨äº†å¤šç§ç±»å‹
    uid: [Number, String],
  },
})
```

#### å¯é€‰ä»¥åŠå¸¦æœ‰é»˜è®¤å€¼çš„ props

æ‰€æœ‰ props é»˜è®¤éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä¼ é€’å…·ä½“çš„å€¼ï¼Œåˆ™é»˜è®¤å€¼éƒ½æ˜¯Â `undefined`Â ï¼Œå¯èƒ½å¼•èµ·ç¨‹åºè¿è¡Œå´©æºƒï¼Œ Vue æ”¯æŒå¯¹å¯é€‰çš„ props è®¾ç½®é»˜è®¤å€¼ï¼Œä¹Ÿæ˜¯é€šè¿‡å¯¹è±¡çš„å½¢å¼é…ç½® props çš„é€‰é¡¹ã€‚

å…¶ä¸­æ”¯æŒé…ç½®çš„é€‰é¡¹æœ‰ï¼š

| **é€‰é¡¹** | **ç±»å‹** | **å«ä¹‰** |
| :---: | :---: | --- |
| type | string | ç±»å‹ |
| required | boolean | æ˜¯å¦å¿…ä¼ ï¼ŒÂ `true`Â ä»£è¡¨å¿…ä¼ ï¼ŒÂ `false`Â ä»£è¡¨å¯é€‰ |
| default | any | ä¸Â `type`Â é€‰é¡¹çš„ç±»å‹ç›¸å¯¹åº”çš„é»˜è®¤å€¼ï¼Œå¦‚æœÂ `required`Â é€‰é¡¹æ˜¯Â `false`Â ï¼Œä½†è¿™é‡Œä¸è®¾ç½®é»˜è®¤å€¼ï¼Œåˆ™ä¼šé»˜è®¤ä¸ºÂ `undefined` |
| validator | function | è‡ªå®šä¹‰éªŒè¯å‡½æ•°ï¼Œéœ€è¦ return ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒÂ `true`Â ä»£è¡¨æ ¡éªŒé€šè¿‡ï¼ŒÂ `false`Â ä»£è¡¨æ ¡éªŒä¸é€šè¿‡ï¼Œå½“æ ¡éªŒä¸é€šè¿‡æ—¶ï¼Œæ§åˆ¶å°ä¼šæŠ›å‡ºè­¦å‘Šä¿¡æ¯ |

äº†è§£äº†é…ç½®é€‰é¡¹åï¼Œæ¥ä¸‹æ¥å†å¯¹ props è¿›è¡Œæ”¹é€ ï¼Œå°†å…¶ä¸­éƒ¨åˆ†é€‰é¡¹è®¾ç½®ä¸ºå¯é€‰ï¼Œå¹¶æä¾›é»˜è®¤å€¼ï¼š

```ts
// Child.vue
export default defineComponent({
  props: {
    // å¯é€‰ï¼Œå¹¶æä¾›é»˜è®¤å€¼
    title: {
      type: String,
      required: false,
      default: 'é»˜è®¤æ ‡é¢˜',
    },

    // é»˜è®¤å¯é€‰ï¼Œå•ç±»å‹
    index: Number,

    // æ·»åŠ ä¸€äº›è‡ªå®šä¹‰æ ¡éªŒ
    userName: {
      type: String,

      // åœ¨è¿™é‡Œæ ¡éªŒç”¨æˆ·åå¿…é¡»è‡³å°‘ 3 ä¸ªå­—
      validator: (v) => v.length >= 3,
    },

    // é»˜è®¤å¯é€‰ï¼Œä½†å…è®¸å¤šç§ç±»å‹
    uid: [Number, String],
  },
})
```

#### ä½¿ç”¨ props

è¯¥éƒ¨åˆ†ä¹Ÿæ˜¯åœ¨Child.vueä¸­æ“ä½œã€‚

åœ¨Â `<template />`Â éƒ¨åˆ†ï¼Œ Vue 3 çš„ä½¿ç”¨æ–¹æ³•å’Œ Vue 2 æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚è¦æ¸²æŸ“çˆ¶ç»„ä»¶ä¼ å…¥çš„ props ï¼š

```vue
<!-- Child.vue -->
<template>
  <p>æ ‡é¢˜ï¼š{{ title }}</p>
  <p>ç´¢å¼•ï¼š{{ index }}</p>
  <p>ç”¨æˆ·idï¼š{{ uid }}</p>
  <p>ç”¨æˆ·åï¼š{{ userName }}</p>
</template>
```

åœ¨ Vue 2 é‡Œï¼Œåªéœ€è¦é€šè¿‡Â `this.uid`Â ã€Â `this.userName`Â å°±å¯ä»¥ä½¿ç”¨çˆ¶ç»„ä»¶ä¼ ä¸‹æ¥çš„ Prop ï¼Œä½†æ˜¯ Vue 3 æ²¡æœ‰äº†Â `this`Â ï¼Œæ‰€ä»¥æ˜¯é€šè¿‡Â `setup`Â çš„å…¥å‚è¿›è¡Œæ“ä½œ:

```ts
// Child.vue
export default defineComponent({
  props: {
    title: String,
    index: Number,
    userName: String,
    uid: Number,
  },

  // åœ¨è¿™é‡Œéœ€è¦æ·»åŠ ä¸€ä¸ªå…¥å‚
  setup(props) {
    // è¯¥å…¥å‚åŒ…å«äº†å½“å‰ç»„ä»¶å®šä¹‰çš„æ‰€æœ‰ props
    console.log(props)
  },
})
```

å…³äº Setup å‡½æ•°çš„ç¬¬ä¸€ä¸ªå…¥å‚Â `props`Â ï¼š

1. è¯¥å…¥å‚åŒ…å«äº†å½“å‰ç»„ä»¶å®šä¹‰çš„æ‰€æœ‰ props ï¼ˆå¦‚æœçˆ¶ç»„ä»¶ Father.vue ä¼ è¿›æ¥çš„æ•°æ®åœ¨ Child.vue é‡Œæœªå®šä¹‰ï¼Œä¸ä»…ä¸ä¼šæ‹¿åˆ°ï¼Œå¹¶ä¸”åœ¨æ§åˆ¶å°ä¼šæœ‰è­¦å‘Šä¿¡æ¯ï¼‰ã€‚
2. è¯¥å…¥å‚å¯ä»¥éšæ„å‘½åï¼Œæ¯”å¦‚å¯ä»¥å†™æˆä¸€ä¸ªä¸‹åˆ’çº¿Â `_`Â ï¼Œé€šè¿‡Â `_.uid`Â ä¹Ÿå¯ä»¥æ‹¿åˆ°æ•°æ®ï¼Œä½†æ˜¯è¯­ä¹‰åŒ–å‘½åæ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚
3. è¯¥å…¥å‚å…·å¤‡å“åº”æ€§ï¼Œçˆ¶ç»„ä»¶ä¿®æ”¹äº†ä¼ é€’ä¸‹æ¥çš„å€¼ï¼Œå­ç»„ä»¶ä¹Ÿä¼šåŒæ­¥å¾—åˆ°æ›´æ–°ï¼Œå› æ­¤è¯·ä¸è¦ç›´æ¥è§£æ„ï¼Œå¯ä»¥é€šè¿‡Â toRef æˆ– toRefsÂ API è½¬æ¢ä¸ºå“åº”å¼å˜é‡

#### ä¼ é€’å’Œè·å–épropså±æ€§

å¦‚æœçˆ¶ç»„ä»¶ Father.vue ä¼ è¿›æ¥çš„æ•°æ®åœ¨ Child.vue é‡Œæœªå®šä¹‰ï¼Œä¸ä»…ä¸ä¼šæ‹¿åˆ°ï¼Œå¹¶ä¸”åœ¨æ§åˆ¶å°ä¼šæœ‰è­¦å‘Šä¿¡æ¯ã€‚è¿™ç§æƒ…å†µè™½ç„¶æ— æ³•ä» props é‡Œæ‹¿åˆ°å¯¹åº”çš„æ•°æ®ï¼Œä½†ä¹Ÿä¸æ„å‘³ç€ä¸èƒ½ä¼ é€’ä»»ä½•æœªå®šä¹‰çš„å±æ€§æ•°æ®ï¼Œåœ¨çˆ¶ç»„ä»¶ï¼Œé™¤äº†å¯ä»¥ç»™å­ç»„ä»¶ç»‘å®š props ï¼Œè¿˜å¯ä»¥æ ¹æ®å®é™…éœ€è¦å»ç»‘å®šä¸€äº›ç‰¹æ®Šçš„å±æ€§ã€‚

æ¯”å¦‚ç»™å­ç»„ä»¶è®¾ç½®Â `class`ã€`id`ï¼Œæˆ–è€…Â `data-xxx`Â ä¹‹ç±»çš„ä¸€äº›è‡ªå®šä¹‰å±æ€§ï¼Œå¦‚æœå­ç»„ä»¶ Child.vue çš„Â `<template />`Â é‡Œåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™äº›å±æ€§é»˜è®¤ä¼šè‡ªåŠ¨ç»§æ‰¿å¹¶æ¸²æŸ“åœ¨ Node èŠ‚ç‚¹ä¸Šã€‚

è¿™ä¸€ç±»é props å±æ€§é€šå¸¸ç§°ä¹‹ä¸º **attrs** ã€‚

åœ¨ Child.vue é‡Œï¼Œå¯ä»¥é€šè¿‡Â `setup`Â çš„ç¬¬äºŒä¸ªå‚æ•°Â `context`Â é‡Œçš„Â `attrs`Â æ¥è·å–åˆ°è¿™äº›å±æ€§ï¼Œå¹¶ä¸”çˆ¶ç»„ä»¶ä¼ é€’äº†ä»€ä¹ˆç±»å‹çš„å€¼ï¼Œè·å–åˆ°çš„ä¹Ÿæ˜¯ä¸€æ ·çš„ç±»å‹ï¼Œè¿™ä¸€ç‚¹å’Œä½¿ç”¨Â `Element.getAttribute()`Â å®Œå…¨ä¸åŒã€‚Vue 3 å…è®¸å¤šä¸ªæ ¹èŠ‚ç‚¹ï¼Œå¤šä¸ªæ ¹èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œæ— æ³•ç›´æ¥ç»§æ‰¿è¿™äº› attrs å±æ€§ï¼ˆåœ¨Â `inheritAttrs: true`Â çš„æƒ…å†µä¹Ÿä¸‹æ— æ³•é»˜è®¤ç»§æ‰¿ï¼‰ï¼Œéœ€è¦åœ¨å­ç»„ä»¶ Child.vue é‡Œé€šè¿‡Â `v-bind`Â ç»‘å®šåˆ°è¦ç»§æ‰¿åœ¨èŠ‚ç‚¹ä¸Šã€‚

#### ç»‘å®šã€æ¥æ”¶ã€è°ƒç”¨ä¸æ ¡éªŒemits

çˆ¶ç»„ä»¶ Father.vue éœ€è¦è·å–å­ç»„ä»¶ Child.vue çš„æ•°æ®æ›´æ–°æƒ…å†µï¼Œå¯ä»¥ç”±å­ç»„ä»¶é€šè¿‡ emits è¿›è¡Œé€šçŸ¥ã€‚äº‹ä»¶çš„é€»è¾‘æ˜¯ç”±çˆ¶ç»„ä»¶å†³å®šçš„ï¼Œå› æ­¤éœ€è¦åœ¨çˆ¶ç»„ä»¶ Father.vue çš„ `<script />` é‡Œå…ˆå£°æ˜æ•°æ®å˜é‡å’Œä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ›´æ–°å‡½æ•°é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå…¥å‚ä½œä¸ºæ•°æ®çš„æ–°å€¼æ¥æ”¶ã€‚

å’Œ props ä¸€æ ·ï¼Œå¯ä»¥æŒ‡å®šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒæŠŠè¦æ¥æ”¶çš„ emit äº‹ä»¶åç§°å†™è¿›å»ï¼›å¦‚æœå­ç»„ä»¶éœ€è¦æ›´æ–°æ•°æ®å¹¶é€šçŸ¥çˆ¶ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `setup` ç¬¬äºŒä¸ªå‚æ•° `context` é‡Œçš„ `emit` æ–¹æ³•è§¦å‘ã€‚`emit` æ–¹æ³•æœ€å°‘è¦ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼šäº‹ä»¶åç§°ã€‚

äº‹ä»¶åç§°æ˜¯æŒ‡çˆ¶ç»„ä»¶ Father.vue ç»‘å®šäº‹ä»¶æ—¶Â `@update-age="updateAge"`Â é‡Œçš„Â `update-age`Â ï¼Œå¦‚æœæ”¹æˆÂ `@hello="updateAge"`Â ï¼Œé‚£ä¹ˆäº‹ä»¶åç§°å°±éœ€è¦ä½¿ç”¨Â `hello`Â ï¼Œä¸€èˆ¬æƒ…å†µä¸‹äº‹ä»¶åç§°å’Œæ›´æ–°å‡½æ•°çš„åç§°ä¼šä¿æŒä¸€è‡´ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚

å¯¹äºéœ€è¦æ›´æ–°æ•°æ®çš„æƒ…å†µï¼ŒÂ `emit`Â è¿˜æ”¯æŒä¼ é€’æ›´å¤šçš„å‚æ•°ï¼Œå¯¹åº”æ›´æ–°å‡½æ•°é‡Œçš„å…¥å‚ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ä¸Šé¢ä¾‹å­é‡Œçš„Â `emit('update-age', 2)`Â æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ é€’äº†ä¸€ä¸ªÂ `2`Â çš„æ•°å€¼ï¼Œå°±æ˜¯ä½œä¸ºçˆ¶ç»„ä»¶Â `updateAge`Â çš„å…¥å‚Â `newAge`Â ä¼ é€’ã€‚

å¦‚æœéœ€è¦é€šä¿¡çš„æ•°æ®å¾ˆå¤šï¼Œå»ºè®®ç¬¬äºŒä¸ªå…¥å‚ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥ç®¡ç†æ•°æ®ï¼›å­ç»„ä»¶åœ¨ä¼ é€’æ–°æ•°æ®æ—¶ï¼Œå°±åº”è¯¥ä½¿ç”¨å¯¹è±¡çš„å½¢å¼ä¼ é€’ï¼›è¿™å¯¹äºæ›´æ–°è¡¨å•ç­‰æ•°æ®é‡è¾ƒå¤šçš„åœºæ™¯éå¸¸å¥½ç”¨ã€‚

å’Œ props ä¸€æ ·ï¼Œå­ç»„ä»¶åœ¨æ¥æ”¶ emits æ—¶ä¹Ÿå¯ä»¥å¯¹è¿™äº›äº‹ä»¶åšä¸€äº›éªŒè¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å°† emits é…ç½®ä¸ºå¯¹è±¡ï¼Œç„¶åæŠŠäº‹ä»¶åç§°ä½œä¸ºÂ `key`Â ï¼ŒÂ `value`Â åˆ™å¯¹åº”ä¸ºä¸€ä¸ªç”¨æ¥æ ¡éªŒçš„æ–¹æ³•ã€‚

### v-model / emits

ä½¿ç”¨ v-model çš„æ–¹å¼æ›´ä¸ºç®€å•ï¼š

1. åœ¨ Father.vue ï¼Œé€šè¿‡ v-model å‘ Child.vue ä¼ å€¼
2. Child.vue é€šè¿‡è‡ªèº«è®¾å®šçš„ emits å‘ Father.vue é€šçŸ¥æ•°æ®æ›´æ–°

v-model çš„ç”¨æ³•å’Œ props éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å¾ˆå¤šæ“ä½œä¸Šæ›´ä¸ºç®€åŒ–ï¼Œä½†æ“ä½œç®€å•å¸¦æ¥çš„ â€œå‰¯ä½œç”¨â€ ï¼Œå°±æ˜¯åŠŸèƒ½ä¸Šä¹Ÿæ²¡æœ‰ props é‚£ä¹ˆå¤šã€‚

#### ç»‘å®š v-model

åœ¨ Father.vue é‡Œæ“ä½œï¼Œå’Œä¸‹å‘ props çš„æ–¹å¼ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨å­ç»„ä»¶ä¸Šç»‘å®š Father.vue å®šä¹‰å¥½çš„æ•°æ®ï¼Œè¿™æ˜¯ç»‘å®šä¸€ä¸ªæ•°æ®çš„ä¾‹å­ï¼š

```vue
<!-- Father.vue -->
<template>
  <Child v-model:username="userInfo.name" />
</template>
```

Vue 3 å¯ä»¥ç›´æ¥ç»‘å®š v-model ï¼Œè€Œæ— éœ€åœ¨å­ç»„ä»¶æŒ‡å®š model é€‰é¡¹ï¼Œå¹¶ä¸” Vue 3 çš„ v-model éœ€è¦ä½¿ç”¨è‹±æ–‡å†’å· : æŒ‡å®šè¦ç»‘å®šçš„å±æ€§åï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒç»‘å®šå¤šä¸ª v-model ã€‚å¦‚æœè¦ç»‘å®šå¤šä¸ªæ•°æ®ï¼Œå†™å¤šä¸ª v-model å³å¯ï¼š

```vue
<!-- Father.vue -->
<template>
  <Child
    v-model:uid="userInfo.id"
    v-model:username="userInfo.name"
    v-model:age="userInfo.age"
  />
</template>
```

ä¸€ä¸ª v-model å…¶å®å°±æ˜¯ä¸€ä¸ª prop ï¼Œå®ƒæ”¯æŒçš„æ•°æ®ç±»å‹å’Œ prop æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å­ç»„ä»¶åœ¨æ¥æ”¶æ•°æ®çš„æ—¶å€™ï¼Œå®Œå…¨æŒ‰ç…§ props å»å®šä¹‰å°±å¯ä»¥äº†ã€‚

#### é…ç½®emits

ä½¿ç”¨ props / emits ï¼Œå¦‚æœè¦æ›´æ–°çˆ¶ç»„ä»¶çš„æ•°æ®ï¼Œè¿˜éœ€è¦åœ¨çˆ¶ç»„ä»¶å£°æ˜ä¸€ä¸ªæ›´æ–°å‡½æ•°å¹¶ç»‘å®šäº‹ä»¶ç»™å­ç»„ä»¶ï¼Œæ‰èƒ½å¤Ÿæ›´æ–°ã€‚

è€Œä½¿ç”¨ v-model / emits ï¼Œæ— éœ€åœ¨çˆ¶ç»„ä»¶å£°æ˜æ›´æ–°å‡½æ•°ï¼Œåªéœ€è¦åœ¨å­ç»„ä»¶ Child.vue é‡Œé€šè¿‡Â `update:`Â å‰ç¼€åŠ ä¸Š v-model çš„å±æ€§åè¿™æ ·çš„æ ¼å¼ï¼Œå³å¯ç›´æ¥å®šä¹‰ä¸€ä¸ªæ›´æ–°äº‹ä»¶ï¼š

```ts
// Child.vue
export default defineComponent({
  props: {
    uid: Number,
    username: String,
    age: Number,
  },
  // æ³¨æ„è¿™é‡Œçš„ `update:` å‰ç¼€
  emits: ['update:uid', 'update:username', 'update:age'],
})
```

### ref / emits

çˆ¶ç»„ä»¶å¯ä»¥ç»™å­ç»„ä»¶ç»‘å®šÂ `ref`Â å±æ€§ï¼Œç„¶åé€šè¿‡ Ref å˜é‡æ“ä½œå­ç»„ä»¶çš„æ•°æ®æˆ–è€…è°ƒç”¨å­ç»„ä»¶é‡Œé¢çš„æ–¹æ³•ã€‚å…ˆåœ¨Â `<template />`Â å¤„ç»™å­ç»„ä»¶æ ‡ç­¾ç»‘å®šÂ `ref`Â å±æ€§ï¼š

```vue
<!-- Father.vue -->
<template>
  <Child ref="child" />
</template>
```

ç„¶ååœ¨Â `<script />`Â éƒ¨åˆ†å®šä¹‰å¥½å¯¹åº”çš„å˜é‡åç§°Â `child`Â ï¼ˆè®°å¾—è¦ return å‡ºæ¥å“¦ï¼‰ï¼Œå³å¯é€šè¿‡è¯¥å˜é‡æ“ä½œå­ç»„ä»¶ä¸Šçš„å˜é‡æˆ–æ–¹æ³•ï¼š

```ts
// Father.vue
import { defineComponent, onMounted, ref } from 'vue'
import Child from '@cp/Child.vue'

export default defineComponent({
  components: {
    Child,
  },
  setup() {
    // ç»™å­ç»„ä»¶å®šä¹‰ä¸€ä¸ª `ref` å˜é‡
    const child = ref<InstanceType<typeof Child>>()

    // è¯·ä¿è¯è§†å›¾æ¸²æŸ“å®Œæ¯•åå†æ‰§è¡Œæ“ä½œ
    onMounted(async () => {
      // æ‰§è¡Œå­ç»„ä»¶é‡Œé¢çš„ AJAX è¯·æ±‚å‡½æ•°
      await child.value!.queryList()

      // æ˜¾ç¤ºå­ç»„ä»¶é‡Œé¢çš„å¼¹çª—
      child.value!.isShowDialog = true
    })

    // å¿…é¡» `return` å‡ºå»æ‰å¯ä»¥ç»™åˆ° `<template />` ä½¿ç”¨
    return {
      child,
    }
  },
})
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å­ç»„ä»¶ Child.vue é‡Œï¼Œå˜é‡å’Œæ–¹æ³•ä¹Ÿéœ€è¦åœ¨ `setup` é‡Œ return å‡ºæ¥æ‰å¯ä»¥è¢«çˆ¶ç»„ä»¶è°ƒç”¨åˆ°ã€‚

## çˆ·å­™ç»„ä»¶é€šä¿¡

çˆ·å­™ç»„ä»¶æ˜¯æ¯”[çˆ¶å­ç»„ä»¶é€šä¿¡](#çˆ¶å­ç»„ä»¶é€šä¿¡)è¦æ›´æ·±å±‚æ¬¡çš„å¼•ç”¨å…³ç³»ï¼ˆä¹Ÿæœ‰ç§°ä¹‹ä¸º â€œéš”ä»£ç»„ä»¶â€ ï¼‰ã€‚

C ç»„ä»¶è¢«å¼•å…¥åˆ° B ç»„ä»¶é‡Œï¼Œ B ç»„ä»¶åˆè¢«å¼•å…¥åˆ° A ç»„ä»¶é‡Œæ¸²æŸ“ï¼Œæ­¤æ—¶ A æ˜¯ C çš„çˆ·çˆ·çº§åˆ«ï¼ˆå¯èƒ½è¿˜æœ‰æ›´å¤šå±‚çº§å…³ç³»ï¼‰ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å¯ä»¥å‡è®¾å¦‚ä¸‹ï¼š

```bash
Grandfather.vue
â””â”€Son.vue
  â””â”€Grandson.vue
```

Grandson.vue å¹¶éç›´æ¥æŒ‚è½½åœ¨ Grandfather.vue ä¸‹é¢ï¼Œä»–ä»¬ä¹‹é—´è¿˜éš”ç€è‡³å°‘ä¸€ä¸ª Son.vue ï¼ˆåœ¨å®é™…ä¸šåŠ¡ä¸­å¯èƒ½å­˜åœ¨æ›´å¤šå±‚çº§ï¼‰ï¼Œå¦‚æœä½¿ç”¨ props ï¼Œåªèƒ½ä¸€çº§ç»„ä»¶ä¸€çº§ç»„ä»¶ä¼ é€’ä¸‹å»ï¼Œå¤ªç¹çã€‚

<div style="text-align: center;">
<img src="/assets/images/æŠ€æœ¯æ‚è°ˆ/å‰ç«¯å¼€å‘5_ç»„ä»¶é€šä¿¡å’ŒçŠ¶æ€ç®¡ç†/propså¤šçº§ä¼ é€’.png" alt="æè¿°æ–‡å­—" width="680" height="340">
</div>

å› æ­¤éœ€è¦æ›´ç›´æ¥çš„é€šä¿¡æ–¹å¼æ¥è§£å†³è¿™ç§é—®é¢˜ï¼Œè¿™ä¸€ Part å°±æ˜¯è®²ä¸€è®² C å’Œ A ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š

| **æ–¹æ¡ˆ** | **çˆ·ç»„ä»¶å‘å­™ç»„ä»¶** | **å­™ç»„ä»¶å‘çˆ·ç»„ä»¶** |
| :---: | :---: | :---: |
| provide / inject | provide | inject |
| EventBus | emit / on | emit / on |
| Reactive State | - | - |
| Vuex | - | - |
| Pinia | - | - |

å› ä¸ºä¸Šä¸‹çº§çš„å…³ç³»çš„ä¸€è‡´æ€§ï¼Œçˆ·å­™ç»„ä»¶é€šä¿¡çš„æ–¹æ¡ˆä¹Ÿé€‚ç”¨äºçˆ¶å­ç»„ä»¶é€šä¿¡ï¼Œåªéœ€è¦æŠŠçˆ·å­™å…³ç³»æ¢æˆçˆ¶å­å…³ç³»å³å¯ï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä¸‹é¢çš„çˆ·ç»„ä»¶ç»Ÿä¸€å« Grandfather.vueï¼Œå­ç»„ä»¶ç»Ÿä¸€å« Grandson.vue ã€‚

### provide / inject

è¿™ä¸ªé€šä¿¡æ–¹å¼ä¹Ÿæ˜¯æœ‰ä¸¤éƒ¨åˆ†ï¼š

1. Grandfather.vue é€šè¿‡ provide å‘å­™ç»„ä»¶ Grandson.vue æä¾›æ•°æ®å’Œæ–¹æ³•
2. Grandson.vue é€šè¿‡ inject æ³¨å…¥çˆ·çˆ·ç»„ä»¶ Grandfather.vue çš„æ•°æ®å’Œæ–¹æ³•

æ— è®ºç»„ä»¶å±‚æ¬¡ç»“æ„æœ‰å¤šæ·±ï¼Œå‘èµ· provide çš„ç»„ä»¶éƒ½å¯ä»¥ä½œä¸ºå…¶æ‰€æœ‰ä¸‹çº§ç»„ä»¶çš„ä¾èµ–æä¾›è€…ã€‚provide å’Œ inject ç»‘å®šå¹¶ä¸æ˜¯å¯å“åº”çš„ï¼Œè¿™æ˜¯åˆ»æ„ä¸ºä¹‹çš„ï¼Œé™¤éä¼ å…¥äº†ä¸€ä¸ªå¯ä¾¦å¬çš„å¯¹è±¡ã€‚

<div style="text-align: center;">
<img src="/assets/images/æŠ€æœ¯æ‚è°ˆ/å‰ç«¯å¼€å‘5_ç»„ä»¶é€šä¿¡å’ŒçŠ¶æ€ç®¡ç†/provide_inject.png" alt="æè¿°æ–‡å­—" width="680" height="340">
</div>

#### å‘èµ· provide

åœ¨ Vue 3 ï¼Œ provide éœ€è¦å¯¼å…¥å¹¶åœ¨ `setup` é‡Œå¯ç”¨ï¼Œå¹¶ä¸”ç°åœ¨æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ–¹æ³•ï¼Œæ¯æ¬¡è¦ provide ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°±è¦å•ç‹¬è°ƒç”¨ä¸€æ¬¡ã€‚provide çš„ TS ç±»å‹å¦‚ä¸‹ï¼š

```ts
// `provide` API æœ¬èº«çš„ç±»å‹
function provide<T>(key: InjectionKey<T> | string, value: T): void

// å…¥å‚ `key` çš„å…¶ä¸­ä¸€ç§ç±»å‹
interface InjectionKey<T> extends Symbol {}
```

æ¯æ¬¡è°ƒç”¨ provide çš„æ—¶å€™éƒ½éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š

| **å‚æ•°** | **è¯´æ˜** |
| :---: | --- |
| key | æ•°æ®çš„åç§° |
| value | æ•°æ®çš„å€¼ |

å…¶ä¸­ key ä¸€èˆ¬ä½¿ç”¨Â `string`Â ç±»å‹å°±å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯ï¼Œå¦‚æœæœ‰ç‰¹æ®Šçš„éœ€è¦ï¼ˆä¾‹å¦‚å¼€å‘æ’ä»¶æ—¶å¯ä»¥é¿å…å’Œç”¨æˆ·çš„ä¸šåŠ¡å†²çªï¼‰ï¼Œå¯ä»¥ä½¿ç”¨Â `InjectionKey<T>`Â ç±»å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª Symbol çš„æ³›å‹ï¼š

```ts
import type { InjectionKey } from 'vue'
const key = Symbol() as InjectionKey<string>
```

ä¸€ä¸ªå…·ä½“æ¡ˆä¾‹å¦‚ä¸‹ï¼š

```ts
// Grandfather.vue
import { defineComponent, provide, ref } from 'vue'

export default defineComponent({
  setup() {
    // å£°æ˜ä¸€ä¸ªå“åº”æ€§å˜é‡å¹¶ provide å…¶è‡ªèº«
    // å­™ç»„ä»¶è·å–åå¯ä»¥ä¿æŒå“åº”æ€§
    const msg = ref('Hello World!')
    provide('msg', msg)

    // åª provide å“åº”å¼å˜é‡çš„å€¼
    // å­™ç»„ä»¶è·å–ååªä¼šå¾—åˆ°å½“å‰çš„å€¼
    provide('msgValue', msg.value)

    // å£°æ˜ä¸€ä¸ªæ–¹æ³•å¹¶ provide
    function printMsg() {
      console.log(msg.value)
    }
    provide('printMsg', printMsg)
  },
})
```

#### æ¥æ”¶ inject

åœ¨ Vue 3 ï¼Œ inject å’Œ provide ä¸€æ ·ï¼Œä¹Ÿæ˜¯éœ€è¦å…ˆå¯¼å…¥ç„¶ååœ¨ `setup` é‡Œå¯ç”¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå…¨æ–°çš„æ–¹æ³•ï¼Œæ¯æ¬¡è¦ inject ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯è¦å•ç‹¬è°ƒç”¨ä¸€æ¬¡ã€‚

å¦å¤–è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µéœ€è¦æ³¨æ„ï¼Œå½“ Grandson.vue çš„çˆ¶çº§ã€çˆ·çº§ç»„ä»¶éƒ½ provide äº†ç›¸åŒåå­—çš„æ•°æ®ä¸‹æ¥ï¼Œé‚£ä¹ˆåœ¨ inject çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆé€‰æ‹©ç¦»å®ƒæ›´è¿‘çš„ç»„ä»¶çš„æ•°æ®ã€‚

æ ¹æ®ä¸åŒçš„åœºæ™¯ï¼Œ inject å¯ä»¥æ¥å—ä¸åŒæ•°é‡çš„å…¥å‚ï¼Œå…¥å‚ç±»å‹ä¹Ÿå„ä¸ç›¸åŒã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ inject API çš„ TS ç±»å‹å¦‚ä¸‹ï¼š

```ts
function inject<T>(key: InjectionKey<T> | string): T | undefined
```

æ¯æ¬¡è°ƒç”¨æ—¶åªéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼š

| **å‚æ•°** | **ç±»å‹** | **è¯´æ˜** |
| :---: | :---: | --- |
| key | string | ä¸ provide ç›¸å¯¹åº”çš„æ•°æ®åç§° |

åœ¨å­™ç»„ä»¶é‡Œ inject çˆ·ç»„ä»¶ provide ä¸‹æ¥çš„æ•°æ®ï¼š

```ts
// Grandson.vue
import { defineComponent, inject } from 'vue'
import type { Ref } from 'vue'

export default defineComponent({
  setup() {
    // è·å–å“åº”å¼å˜é‡
    const msg = inject<Ref<string>>('msg')
    console.log(msg!.value)

    // è·å–æ™®é€šçš„å­—ç¬¦ä¸²
    const msgValue = inject<string>('msgValue')
    console.log(msgValue)

    // è·å–å‡½æ•°
    const printMsg = inject<() => void>('printMsg')
    if (typeof printMsg === 'function') {
      printMsg()
    }
  },
})
```

åœ¨æ¯ä¸ª inject éƒ½ä½¿ç”¨å°–æ‹¬å·Â `<>`Â æ·»åŠ äº†ç›¸åº”çš„ TS ç±»å‹ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨å˜é‡çš„æ—¶å€™éƒ½è¿›è¡Œäº†åˆ¤æ–­ï¼Œè¿™æ˜¯å› ä¸ºé»˜è®¤çš„æƒ…å†µä¸‹ï¼Œ inject é™¤äº†è¿”å›æŒ‡å®šç±»å‹çš„æ•°æ®ä¹‹å¤–ï¼Œè¿˜é»˜è®¤å¸¦ä¸ŠÂ `undefined`Â ä½œä¸ºå¯èƒ½çš„å€¼ã€‚

å¦‚æœæ˜ç¡®æ•°æ®ä¸ä¼šæ˜¯Â `undefined`Â ï¼Œä¹Ÿå¯ä»¥åœ¨åé¢æ·»åŠ Â `as`Â å…³é”®å­—æŒ‡å®šå…¶ TS ç±»å‹ï¼Œè¿™æ · TypeScript å°±ä¸å†å› ä¸ºå¯èƒ½å‡ºç°Â `undefined`Â è€Œæç¤ºä»£ç æœ‰é—®é¢˜ï¼š

```ts
// Grandson.vue
import { defineComponent, inject } from 'vue'
import type { Ref } from 'vue'

export default defineComponent({
  setup() {
    // è·å–å“åº”å¼å˜é‡
    const msg = inject('msg') as Ref<string>
    console.log(msg.value)

    // è·å–æ™®é€šçš„å­—ç¬¦ä¸²
    const msgValue = inject('msgValue') as string
    console.log(msgValue)

    // è·å–å‡½æ•°
    const printMsg = inject('printMsg') as () => void
    printMsg()
  },
})
```

inject API è¿˜æ”¯æŒè®¾ç½®é»˜è®¤å€¼ï¼Œå¯ä»¥æ¥å—æ›´å¤šçš„å‚æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªéœ€è¦ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šé»˜è®¤å€¼å³å¯ï¼Œæ­¤æ—¶å®ƒçš„ TS ç±»å‹å¦‚ä¸‹ï¼š

```ts
function inject<T>(key: InjectionKey<T> | string, defaultValue: T): T
```

å¯¹äºä¸å¯æ§çš„æƒ…å†µï¼Œå»ºè®®åœ¨ inject æ—¶æ·»åŠ ä¸€ä¸ªå…œåº•çš„é»˜è®¤å€¼ï¼Œé˜²æ­¢ç¨‹åºæŠ¥é”™ï¼š

```ts
// Grandson.vue
import { defineComponent, inject, ref } from 'vue'
import type { Ref } from 'vue'

export default defineComponent({
  setup() {
    // è·å–å“åº”å¼å˜é‡
    const msg = inject<Ref<string>>('msg', ref('Hello'))
    console.log(msg.value)

    // è·å–æ™®é€šçš„å­—ç¬¦ä¸²
    const msgValue = inject<string>('msgValue', 'Hello')
    console.log(msgValue)

    // è·å–å‡½æ•°
    const printMsg = inject<() => void>('printMsg', () => {
      console.log('Hello')
    })
    printMsg()
  },
})
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ inject çš„ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œå…¶é»˜è®¤å€¼ä¹Ÿéœ€è¦ä¿æŒç›¸åŒçš„ç±»å‹ã€‚

inject API åœ¨ç¬¬äºŒä¸ª TS ç±»å‹çš„åŸºç¡€ä¸Šï¼Œè¿˜æœ‰ç¬¬ä¸‰ä¸ª TS ç±»å‹ï¼Œå¯ä»¥ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š

```ts
function inject<T>(
  key: InjectionKey<T> | string,
  defaultValue: () => T,
  treatDefaultAsFactory?: false,
): T
```

å½“ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œé‚£ä¹ˆå¯ä»¥æ·»åŠ ç¬¬ä¸‰ä¸ªå€¼ï¼Œå°†å…¶è®¾ç½®ä¸º true ï¼Œæ­¤æ—¶é»˜è®¤å€¼ä¸€å®šä¼šæ˜¯å…¶ return çš„å€¼ã€‚åœ¨ Grandson.vue é‡Œæ–°å¢ä¸€ä¸ª inject ï¼Œæ¥æ”¶ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°åï¼Œå¹¶æä¾›ä¸€ä¸ªå·¥å‚å‡½æ•°ä½œä¸ºé»˜è®¤å€¼ï¼š

```ts
// Grandson.vue
import { defineComponent, inject } from 'vue'

interface Food {
  name: string
  count: number
}

export default defineComponent({
  setup() {
    // è·å–å·¥å‚å‡½æ•°
    const getFood = inject<() => Food>('nonexistentFunction', () => {
      return {
        name: 'Pizza',
        count: 1,
      }
    })
    console.log(typeof getFood) // function

    const food = getFood()
    console.log(food) // {name: 'Pizza', count: 1}
  },
})
```

æ­¤æ—¶å› ä¸ºç¬¬ä¸‰ä¸ªå‚æ•°é»˜è®¤ä¸º Falsy å€¼ ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°ä¸€ä¸ªå‡½æ•°ä½œä¸ºé»˜è®¤å€¼ï¼Œå¹¶å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°è·å¾—ä¸€ä¸ª Food å¯¹è±¡ã€‚å¦‚æœå°†ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ä¸ºÂ `true`Â ï¼Œå†è¿è¡Œç¨‹åºåˆ™ä¼šåœ¨Â `const food = getFood()`Â è¿™ä¸€è¡ŒæŠ¥é”™ã€‚å› ä¸ºæ­¤æ—¶ç¬¬ä¸‰ä¸ªå…¥å‚å‘ŠçŸ¥ inject ï¼Œé»˜è®¤å€¼æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå› æ­¤é»˜è®¤å€¼ä¸å†æ˜¯å‡½æ•°æœ¬èº«ï¼Œè€Œæ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼Œæ‰€ä»¥Â `typeof getFood`Â å¾—åˆ°çš„ä¸å†æ˜¯ä¸€ä¸ªÂ `function`Â è€Œæ˜¯ä¸€ä¸ªÂ `object`Â ï¼š

```ts
// Grandson.vue
import { defineComponent, inject } from 'vue'

interface Food {
  name: string
  count: number
}

export default defineComponent({
  setup() {
    // è·å–å·¥å‚å‡½æ•°
    const getFood = inject<() => Food>(
      'nonexistentFunction',
      () => {
        return {
          name: 'Pizza',
          count: 1,
        }
      },
      true
    )
    console.log(typeof getFood) // object

    // æ­¤æ—¶ä¸‹é¢çš„ä»£ç æ— æ³•è¿è¡Œ
    // æŠ¥é”™ Uncaught (in promise) TypeError: getMsg is not a function
    const food = getFood()
    console.log(food)
  },
})
```

## å…„å¼Ÿç»„ä»¶é€šä¿¡

å…„å¼Ÿç»„ä»¶æ˜¯æŒ‡ä¸¤ä¸ªç»„ä»¶éƒ½æŒ‚è½½åœ¨åŒä¸€ä¸ª Father.vue ä¸‹ï¼Œä½†ä¸¤ä¸ªç»„ä»¶ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆç›´æ¥çš„å…³è”ï¼Œå…ˆçœ‹çœ‹å®ƒä»¬çš„å…³ç³»ï¼š

```bash
Father.vue
â”œâ”€Brother.vue
â””â”€LittleBrother.vue
```

è¿™ç§å±‚çº§å…³ç³»ä¸‹ï¼Œå¦‚æœç»„ä»¶ä¹‹é—´è¦è¿›è¡Œé€šä¿¡ï¼Œç›®å‰é€šå¸¸æœ‰è¿™ä¸¤ç±»é€‰æ‹©ï¼š

1. ã€ä¸æ¨èã€‘å…ˆæŠŠæ•°æ®ä¼ ç»™ Father.vue ï¼Œå†ä½¿ç”¨Â [çˆ¶å­ç»„ä»¶é€šä¿¡](#çˆ¶å­ç»„ä»¶é€šä¿¡)Â æ–¹æ¡ˆå¤„ç†
2. ã€æ¨èã€‘å€ŸåŠ©Â [å…¨å±€ç»„ä»¶é€šä¿¡](#å…¨å±€ç»„ä»¶é€šä¿¡)Â çš„æ–¹æ¡ˆè¾¾åˆ°ç›®çš„

ä¸‹é¢çš„å†…å®¹å°†è¿›å…¥å…¨å±€ç»„ä»¶é€šä¿¡çš„è®²è§£ã€‚

## å…¨å±€ç»„ä»¶é€šä¿¡

å…¨å±€ç»„ä»¶é€šä¿¡æ˜¯æŒ‡é¡¹ç›®ä¸‹ä¸¤ä¸ªä»»æ„ç»„ä»¶ï¼Œä¸ç®¡æ˜¯å¦æœ‰ç›´æ¥å…³è”ï¼ˆä¾‹å¦‚çˆ¶å­å…³ç³»ã€çˆ·å­™å…³ç³»ï¼‰éƒ½å¯ä»¥ç›´æ¥è¿›è¡Œäº¤æµçš„é€šä¿¡æ–¹æ¡ˆã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œåƒä¸‹é¢è¿™ç§é¡¹ç›®ç»“æ„ï¼Œ B2.vue å¯ä»¥é‡‡ç”¨å…¨å±€é€šä¿¡æ–¹æ¡ˆç›´æ¥å‘ D2.vue å‘èµ·äº¤æµï¼Œè€Œæ— éœ€ç»è¿‡å®ƒä»¬å„è‡ªçš„çˆ¶ç»„ä»¶ã€‚

```bash
A.vue
â”œâ”€B1.vue
â”œâ”€â”€â”€C1.vue
â”œâ”€â”€â”€â”€â”€D1.vue
â”œâ”€â”€â”€â”€â”€D2.vue
â”œâ”€â”€â”€C2.vue
â”œâ”€â”€â”€â”€â”€D3.vue
â””â”€B2.vue
```

å¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š

| **æ–¹æ¡ˆ** | **å‘èµ·æ–¹** | **æ¥æ”¶æ–¹** |
| :---: | :---: | :---: |
| EventBus | emit | on |
| Reactive State | - | - |
| Vuex | - | - |
| Pinia | - | - |

### EventBus

EventBus é€šå¸¸è¢«ç§°ä¹‹ä¸º â€œå…¨å±€äº‹ä»¶æ€»çº¿â€ ï¼Œæ˜¯ç”¨åœ¨å…¨å±€èŒƒå›´å†…é€šä¿¡çš„ä¸€ä¸ªå¸¸ç”¨æ–¹æ¡ˆï¼›Vue 3 åº”ç”¨å®ä¾‹ä¸å†å®ç°äº‹ä»¶è§¦å‘æ¥å£ï¼Œå› æ­¤ç§»é™¤äº†Â `$on`Â ã€Â `$off`Â å’ŒÂ `$once`Â è¿™å‡ ä¸ªäº‹ä»¶ API ï¼Œæ— æ³•åƒ Vue 2 ä¸€æ ·åˆ©ç”¨ Vue å®ä¾‹åˆ›å»º EventBus ã€‚

ä»¥ mitt ä¸ºä¾‹ï¼Œç¤ºèŒƒå¦‚ä½•åˆ›å»ºä¸€ä¸ª Vue 3 çš„ EventBus ï¼Œé¦–å…ˆéœ€è¦å®‰è£…å®ƒã€‚

```bash
npm i mitt
```

ç„¶ååœ¨ src/libs æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º eventBus.ts çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å’Œ Vue 2 çš„å†™æ³•å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯æŠŠ Vue å®ä¾‹æ¢æˆäº† mitt å®ä¾‹ã€‚

```ts
// src/libs/eventBus.ts
import mitt from 'mitt'
export default mitt()
```

æ¥ä¸‹æ¥å°±å¯ä»¥å®šä¹‰é€šä¿¡çš„ç›¸å…³äº‹ä»¶äº†ï¼Œå¸¸ç”¨çš„ API å’Œå‚æ•°å¦‚ä¸‹ï¼š

| **æ–¹æ³•åç§°** | **ä½œç”¨** |
| :---: | --- |
| on | æ³¨å†Œä¸€ä¸ªä¾¦å¬äº‹ä»¶ï¼Œç”¨äºæ¥æ”¶æ•°æ® |
| emit | è°ƒç”¨æ–¹æ³•å‘èµ·æ•°æ®ä¼ é€’ |
| off | ç”¨æ¥ç§»é™¤ä¾¦å¬äº‹ä»¶ |

`on`Â çš„å‚æ•°ï¼š

| **å‚æ•°** | **ç±»å‹** | **ä½œç”¨** |
| :---: | :---: | --- |
| type | string | symbol | æ–¹æ³•å |
| handler | function | æ¥æ”¶åˆ°æ•°æ®ä¹‹åè¦åšä»€ä¹ˆå¤„ç†çš„å›è°ƒå‡½æ•° |

è¿™é‡Œçš„Â `handler`Â å»ºè®®ä½¿ç”¨å…·åå‡½æ•°ï¼Œå› ä¸ºåŒ¿åå‡½æ•°æ— æ³•é”€æ¯ã€‚

`emit`Â çš„å‚æ•°ï¼š

| **å‚æ•°** | **ç±»å‹** | **ä½œç”¨** |
| :---: | :---: | --- |
| type | string | symbol | ä¸ on å¯¹åº”çš„æ–¹æ³•å |
| data | any | ä¸ on å¯¹åº”çš„ï¼Œå…è®¸æ¥æ”¶çš„æ•°æ® |

`off`Â çš„å‚æ•°ï¼š

| **å‚æ•°** | **ç±»å‹** | **ä½œç”¨** |
| :---: | :---: | --- |
| type | string | symbol | ä¸ on å¯¹åº”çš„æ–¹æ³•å |
| handler | function | è¦è¢«åˆ é™¤çš„ï¼Œä¸ on å¯¹åº”çš„ handler å‡½æ•°å |

#### åˆ›å»ºå’Œç§»é™¤ä¾¦å¬äº‹ä»¶

åœ¨éœ€è¦æš´éœ²äº¤æµäº‹ä»¶çš„ç»„ä»¶é‡Œï¼Œé€šè¿‡Â `on`Â é…ç½®å¥½æ¥æ”¶æ–¹æ³•ï¼ŒåŒæ—¶ä¸ºäº†é¿å…è·¯ç”±åˆ‡æ¢è¿‡ç¨‹ä¸­é€ æˆäº‹ä»¶å¤šæ¬¡è¢«ç»‘å®šï¼Œä»è€Œå¼•èµ·å¤šæ¬¡è§¦å‘ï¼Œéœ€è¦åœ¨é€‚å½“çš„æ—¶æœºÂ `off`Â æ‰ï¼š

```ts
import { defineComponent, onBeforeUnmount } from 'vue'
import eventBus from '@libs/eventBus'

export default defineComponent({
  setup() {
    // å£°æ˜ä¸€ä¸ªæ‰“æ‹›å‘¼çš„æ–¹æ³•
    function sayHi(msg = 'Hello World!') {
      console.log(msg)
    }

    // å¯ç”¨ä¾¦å¬
    eventBus.on('sayHi', sayHi)

    // åœ¨ç»„ä»¶å¸è½½ä¹‹å‰ç§»é™¤ä¾¦å¬
    onBeforeUnmount(() => {
      eventBus.off('sayHi', sayHi)
    })
  },
})
```

#### è°ƒç”¨ä¾¦å¬äº‹ä»¶

åœ¨éœ€è¦è°ƒç”¨äº¤æµäº‹ä»¶çš„ç»„ä»¶é‡Œï¼Œé€šè¿‡ `emit` è¿›è¡Œè°ƒç”¨ï¼š

```ts
import { defineComponent } from 'vue'
import eventBus from '@libs/eventBus'

export default defineComponent({
  setup() {
    // è°ƒç”¨æ‰“æ‹›å‘¼äº‹ä»¶ï¼Œä¼ å…¥æ¶ˆæ¯å†…å®¹
    eventBus.emit('sayHi', 'Hello')
  },
})
```

### Reactive State

åœ¨ Vue 3 é‡Œï¼Œä½¿ç”¨å“åº”å¼çš„ reactive API ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªå°å‹çš„çŠ¶æ€å…±äº«åº“ï¼Œå¦‚æœè¿ç”¨åœ¨ä¸€ä¸ªç®€å•çš„ H5 æ´»åŠ¨é¡µé¢è¿™æ ·å°éœ€æ±‚é‡Œï¼Œå®Œå…¨å¯ä»¥æ»¡è¶³ä½¿ç”¨ã€‚

#### åˆ›å»ºçŠ¶æ€ä¸­å¿ƒ

é¦–å…ˆåœ¨ src ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª state æ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª index.ts æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹ä»£ç ï¼š

```ts
// src/state/index.ts
import { reactive } from 'vue'

// å¦‚æœæœ‰å¤šä¸ªä¸åŒä¸šåŠ¡çš„å†…éƒ¨çŠ¶æ€å…±äº«
// ä½¿ç”¨å…·åå¯¼å‡ºæ›´å®¹æ˜“ç»´æŠ¤
export const state = reactive({
  // è®¾ç½®ä¸€ä¸ªå±æ€§å¹¶èµ‹äºˆåˆå§‹å€¼
  message: 'Hello World',

  // æ·»åŠ ä¸€ä¸ªæ›´æ–°æ•°æ®çš„æ–¹æ³•
  setMessage(msg: string) {
    this.message = msg
  },
})
```

#### è®¾å®šçŠ¶æ€æ›´æ–°é€»è¾‘

æ¥ä¸‹æ¥åœ¨ä¸€ä¸ªç»„ä»¶ Child.vue çš„Â `<script />`Â é‡Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œåˆ†åˆ«è¿›è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š

1. æ‰“å°åˆå§‹å€¼
2. å¯¹ state é‡Œçš„æ•°æ®å¯ç”¨ä¾¦å¬å™¨
3. ä½¿ç”¨ state é‡Œçš„æ–¹æ³•æ›´æ–°æ•°æ®
4. ç›´æ¥æ›´æ–° state çš„æ•°æ®

```ts
// Child.vue
import { defineComponent, watch } from 'vue'
import { state } from '@/state'

export default defineComponent({
  setup() {
    console.log(state.message)
    // Hello World

    // å› ä¸ºæ˜¯å“åº”å¼æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ä¾¦å¬æ•°æ®å˜åŒ–
    watch(
      () => state.message,
      (val) => {
        console.log('Message å‘ç”Ÿå˜åŒ–ï¼š', val)
      },
    )

    setTimeout(() => {
      state.setMessage('Hello Hello')
      // Message å‘ç”Ÿå˜åŒ–ï¼š Hello Hello
    }, 1000)

    setTimeout(() => {
      state.message = 'Hi Hi'
      // Message å‘ç”Ÿå˜åŒ–ï¼š Hi Hi
    }, 2000)
  },
})
```

#### è§‚å¯Ÿå…¨å±€çŠ¶æ€å˜åŒ–

ç»§ç»­åœ¨å¦å¤–ä¸€ä¸ªç»„ä»¶ Father.vue é‡Œå†™å…¥ä»¥ä¸‹ä»£ç ï¼Œå¯¼å…¥ state å¹¶åœ¨ `<template />` æ¸²æŸ“å…¶ä¸­çš„æ•°æ®ï¼š

```vue
<!-- Father.vue -->
<template>
  <div>{{ state.message }}</div>
  <Child />
</template>

<script lang="ts">
import { defineComponent } from 'vue'
import Child from '@cp/Child.vue'
import { state } from '@/state'

export default defineComponent({
  components: {
    Child,
  },
  setup() {
    return {
      state,
    }
  },
})
</script>
```

å¯ä»¥è§‚å¯Ÿåˆ°å½“ Child.vue é‡Œçš„å®šæ—¶å™¨æ‰§è¡Œæ—¶ï¼Œ Father.vue çš„è§†å›¾ä¹Ÿä¼šåŒæ­¥å¾—åˆ°æ›´æ–°ã€‚

### Vuex

Vuex æ˜¯ Vue ç”Ÿæ€é‡Œé¢éå¸¸é‡è¦çš„ä¸€ä¸ªæˆå‘˜ï¼Œè¿ç”¨äºçŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå…¨å±€çš„é€šä¿¡æ–¹æ¡ˆï¼Œå¯¹æ¯” EventBusï¼ŒVuex çš„åŠŸèƒ½æ›´å¤šï¼Œæ›´çµæ´»ï¼Œä½†å¯¹åº”çš„å­¦ä¹ æˆæœ¬å’Œä½“ç§¯ä¹Ÿç›¸å¯¹è¾ƒå¤§ï¼Œé€šå¸¸å¤§å‹é¡¹ç›®æ‰ä¼šç”¨ä¸Š Vuex ã€‚

Pinia å·²ç»æˆä¸º Vue ç”Ÿæ€æœ€æ–°çš„å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ï¼Œä¸ä»…é€‚ç”¨äº Vue 3 ï¼Œä¹Ÿæ”¯æŒ Vue 2 ï¼Œè€Œ Vuex å°†è¿›å…¥ç»´æŠ¤çŠ¶æ€ï¼Œä¸å†å¢åŠ æ–°åŠŸèƒ½ï¼Œ Vue å®˜æ–¹å¼ºçƒˆå»ºè®®åœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨ Pinia ã€‚

### Pinia

Pinia å’Œ Vuex ä¸€æ ·ï¼Œä¹Ÿæ˜¯ Vue ç”Ÿæ€é‡Œé¢éå¸¸é‡è¦çš„ä¸€ä¸ªæˆå‘˜ï¼Œä¹Ÿéƒ½æ˜¯è¿ç”¨äºå…¨å±€çš„çŠ¶æ€ç®¡ç†ã€‚ä½†é¢å‘ Componsition API è€Œç”Ÿçš„ Pinia ï¼Œæ›´å— Vue 3 å–œçˆ±ï¼Œå·²è¢«é’¦å®šä¸ºå®˜æ–¹æ¨èçš„æ–°çŠ¶æ€ç®¡ç†å·¥å…·ã€‚ä¸‹ä¸€éƒ¨åˆ†ä¼šå¯¹å…¶è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚

# å…¨å±€çŠ¶æ€ç®¡ç†

## Piniaçš„å®‰è£…å’Œå¯ç”¨

Pinia ç›®å‰è¿˜æ²¡æœ‰è¢«å¹¿æ³›çš„é»˜è®¤é›†æˆåœ¨å„ç§è„šæ‰‹æ¶é‡Œï¼Œæ‰€ä»¥å¦‚æœåŸæ¥åˆ›å»ºçš„é¡¹ç›®æ²¡æœ‰ Pinia ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å®‰è£…å®ƒï¼š

```bash
# éœ€è¦ cd åˆ°çš„é¡¹ç›®ç›®å½•ä¸‹
npm install pinia
```

æŸ¥çœ‹çš„ package.json ï¼Œçœ‹çœ‹é‡Œé¢çš„ `dependencies` æ˜¯å¦æˆåŠŸåŠ å…¥äº† Pinia å’Œå®ƒçš„ç‰ˆæœ¬å·ï¼ˆä¸‹æ–¹æ˜¯ç¤ºä¾‹ä»£ç ï¼Œä»¥å®é™…å®‰è£…çš„æœ€æ–°ç‰ˆæœ¬å·ä¸ºå‡†ï¼‰ï¼Œä»è€ŒéªŒè¯Piniaæ˜¯å¦é›†æˆåˆ°çš„é¡¹ç›®é‡Œï¼š

```json
{
  "dependencies": {
    "pinia": "^2.0.11"
  }
}
```

ç„¶åæ‰“å¼€ `src/main.ts` æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢é‚£ä¸¤è¡Œæœ‰æ³¨é‡Šçš„æ–°ä»£ç ï¼š

```ts
import { createApp } from 'vue'
import { createPinia } from 'pinia' // å¯¼å…¥ Pinia
import App from '@/App.vue'

createApp(App)
  .use(createPinia()) // å¯ç”¨ Pinia
  .mount('#app')
```

ä¹Ÿå¯ä»¥é€šè¿‡ Create Preset åˆ›å»ºæ–°é¡¹ç›®ï¼ˆé€‰æ‹© vue æŠ€æœ¯æ ˆè¿›å…¥ï¼Œé€‰æ‹© vue3-ts-vite æ¨¡æ¿ï¼‰ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªé›†æˆå¸¸ç”¨é…ç½®çš„é¡¹ç›®å¯åŠ¨æ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿ç°åœ¨ä½¿ç”¨ Pinia ä½œä¸ºå…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·ã€‚

## çŠ¶æ€æ ‘ç»“æ„

å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€ä¸ªå¯¹æ¯”ï¼Œç›´è§‚çš„äº†è§£ Pinia çš„çŠ¶æ€æ ‘æ„æˆï¼Œæ‰èƒ½åœ¨åé¢çš„ç¯èŠ‚æ›´å¥½çš„ç†è§£æ¯ä¸ªåŠŸèƒ½çš„ç”¨é€”ã€‚

| **ä½œç”¨** | **Vue Component** | **Vuex** | **Pinia** |
| --- | --- | --- | --- |
| æ•°æ®ç®¡ç† | data | state | state |
| æ•°æ®è®¡ç®— | computed | getters | getters |
| è¡Œä¸ºæ–¹æ³• | methods | mutations / actions | actions |

å¯ä»¥çœ‹åˆ° Pinia çš„ç»“æ„å’Œç”¨é€”éƒ½å’Œ Vuex ä¸ Component éå¸¸ç›¸ä¼¼ï¼Œå¹¶ä¸” Pinia ç›¸å¯¹äº Vuex ï¼Œåœ¨è¡Œä¸ºæ–¹æ³•éƒ¨åˆ†å»æ‰äº† mutations ï¼ˆåŒæ­¥æ“ä½œï¼‰å’Œ actions ï¼ˆå¼‚æ­¥æ“ä½œï¼‰çš„åŒºåˆ†ï¼Œæ›´æ¥è¿‘ç»„ä»¶çš„ç»“æ„ï¼Œå…¥é—¨æˆæœ¬ä¼šæ›´ä½ä¸€äº›ã€‚

ä¸‹é¢æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ Store ï¼Œå¼€å§‹ç”¨ Pinia æ¥è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚

## åˆ›å»º Store

Pinia çš„æ ¸å¿ƒä¹Ÿæ˜¯ç§°ä¹‹ä¸º Store ã€‚å‚ç…§ Pinia å®˜ç½‘æ¨èçš„é¡¹ç›®ç®¡ç†æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯å…ˆåœ¨Â `src`Â æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªÂ `stores`Â æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨é‡Œé¢æ·»åŠ ä¸€ä¸ªÂ `index.ts`Â æ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥æ¥æ·»åŠ ä¸€ä¸ªæœ€åŸºç¡€çš„ Store ã€‚Store æ˜¯é€šè¿‡Â `defineStore`Â æ–¹æ³•æ¥åˆ›å»ºçš„ï¼Œå®ƒæœ‰ä¸¤ç§å…¥å‚å½¢å¼ï¼š

### å½¢å¼1ï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°

æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Store çš„å”¯ä¸€ ID ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ Store çš„é€‰é¡¹ï¼š

```ts
// src/stores/index.ts
import { defineStore } from 'pinia'

export const useStore = defineStore('main', {
  // Store é€‰é¡¹...
})
```

### å½¢å¼2ï¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°

æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œç›´æ¥ä¼ å…¥ Store çš„é€‰é¡¹ï¼Œä½†æ˜¯éœ€è¦æŠŠå”¯ä¸€ ID ä½œä¸ºé€‰é¡¹çš„ä¸€éƒ¨åˆ†ä¸€èµ·ä¼ å…¥ï¼š

```ts
// src/stores/index.ts
import { defineStore } from 'pinia'

export const useStore = defineStore({
  id: 'main',
  // Store é€‰é¡¹...
})
```

ä¸è®ºæ˜¯å“ªç§åˆ›å»ºå½¢å¼ï¼Œéƒ½å¿…é¡»ä¸º Store æŒ‡å®šä¸€ä¸ªå”¯ä¸€ ID ã€‚å¦å¤–å¯ä»¥çœ‹åˆ°è¿™é‡ŒæŠŠå¯¼å‡ºçš„å‡½æ•°åå‘½åä¸ºÂ `useStore`Â ï¼Œä»¥Â `use`Â å¼€å¤´æ˜¯ Vue 3 å¯¹å¯ç»„åˆå‡½æ•°çš„ä¸€ä¸ªå‘½åçº¦å®šã€‚å¹¶ä¸”ä½¿ç”¨çš„æ˜¯Â `export const`Â è€Œä¸æ˜¯Â `export default`ï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥å’Œå…¶ä»–çš„ Vue ç»„åˆå‡½æ•°ä¿æŒä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡Â `import { xxx } from 'xxx'`Â æ¥å¯¼å…¥ã€‚

å¦‚æœæœ‰å¤šä¸ª Store ï¼Œå¯ä»¥åˆ†æ¨¡å—ç®¡ç†ï¼Œå¹¶æ ¹æ®å®é™…çš„åŠŸèƒ½ç”¨é€”è¿›è¡Œå‘½åï¼ˆ e.g.Â `useMessageStore`Â ã€Â `useUserStore`Â ã€Â `useGameStore`Â â€¦ ï¼‰ã€‚

## ç®¡ç† state

### ç»™ Store æ·»åŠ  state

é€šè¿‡ä¸€ä¸ªç®­å¤´å‡½æ•°çš„å½¢å¼æ¥è¿”å›æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ­£ç¡®çš„å¸®æ¨å¯¼ TypeScript ç±»å‹ï¼š

```ts
// src/stores/index.ts
import { defineStore } from 'pinia'

export const useStore = defineStore('main', {
  // å…ˆå®šä¹‰ä¸€ä¸ªæœ€åŸºæœ¬çš„ message æ•°æ®
  state: () => ({
    message: 'Hello World',
  }),
  // ...
})
```

éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œå¦‚æœä¸æ˜¾å¼ return ï¼Œç®­å¤´å‡½æ•°çš„è¿”å›å€¼éœ€è¦ç”¨åœ†æ‹¬å· () å¥—èµ·æ¥ï¼Œè¿™ä¸ªæ˜¯ç®­å¤´å‡½æ•°çš„è¦æ±‚ã€‚æ‰€ä»¥ç›¸å½“äºè¿™æ ·å†™ï¼š

```ts
// ...
export const useStore = defineStore('main', {
  state: () => {
    return {
      message: 'Hello World',
    }
  },
  // ...
})
```

### æ‰‹åŠ¨æŒ‡å®šæ•°æ®ç±»å‹

è™½ç„¶ Pinia ä¼šå¸®æ¨å¯¼ TypeScript çš„æ•°æ®ç±»å‹ï¼Œä½†æœ‰æ—¶å€™å¯èƒ½ä¸å¤ªå¤Ÿç”¨ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œè¯·ç•™æ„ä»£ç æ³¨é‡Šçš„è¯´æ˜ï¼š

```ts
// ...
export const useStore = defineStore('main', {
  state: () => {
    return {
      message: 'Hello World',
      // æ·»åŠ äº†ä¸€ä¸ªéšæœºæ¶ˆæ¯æ•°ç»„
      randomMessages: [],
    }
  },
  // ...
})
```

`randomMessages`Â çš„é¢„æœŸåº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„Â `string[]`Â ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ Pinia ä¼šå¸®æ¨å¯¼æˆÂ `never[]`Â ï¼Œé‚£ä¹ˆç±»å‹å°±å¯¹ä¸ä¸Šäº†ã€‚è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦æ‰‹åŠ¨æŒ‡å®š randomMessages çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡Â `as`Â æ¥æŒ‡å®šï¼š

```ts
// ...
export const useStore = defineStore('main', {
  state: () => {
    return {
      message: 'Hello World',
      // é€šè¿‡ as å…³é”®å­—æŒ‡å®š TS ç±»å‹
      randomMessages: [] as string[],
    }
  },
  // ...
})
```

æˆ–è€…ä½¿ç”¨å°–æ‹¬å· `<>` æ¥æŒ‡å®šï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼š

```ts
// ...
export const useStore = defineStore('main', {
  state: () => {
    return {
      message: 'Hello World',
      // é€šè¿‡å°–æ‹¬å·æŒ‡å®š TS ç±»å‹
      randomMessages: <string[]>[],
    }
  },
  // ...
})
```

### è·å–å’Œæ›´æ–° state

è·å– state æœ‰å¤šç§æ–¹æ³•ï¼Œç•¥å¾®æœ‰åŒºåˆ«ï¼Œä½†ç›¸åŒçš„æ˜¯ï¼Œä»–ä»¬éƒ½æ˜¯å“åº”æ€§çš„ã€‚

#### ä½¿ç”¨ store å®ä¾‹

å¯¹äºPiniaï¼Œæ•°æ®ç›´æ¥æ˜¯æŒ‚åœ¨ `store` ä¸Šçš„ï¼Œè€Œä¸æ˜¯ `store.state` ä¸Šçš„ã€‚æ‰€ä»¥ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ `store.message` ç›´æ¥è°ƒç”¨ state é‡Œçš„æ•°æ®ï¼š

```ts
import { defineComponent } from 'vue'
import { useStore } from '@/stores'

export default defineComponent({
  setup() {
    // åƒ useRouter é‚£æ ·å®šä¹‰ä¸€ä¸ªå˜é‡æ‹¿åˆ°å®ä¾‹
    const store = useStore()

    // ç›´æ¥é€šè¿‡å®ä¾‹æ¥è·å–æ•°æ®
    console.log(store.message)

    // è¿™ç§æ–¹å¼éœ€è¦æŠŠæ•´ä¸ª store ç»™åˆ° template å»æ¸²æŸ“æ•°æ®
    return {
      store,
    }
  },
})
```

ä½†ä¸€äº›æ¯”è¾ƒå¤æ‚çš„æ•°æ®è¿™æ ·å†™ä¼šå¾ˆé•¿ï¼Œæ‰€ä»¥æœ‰æ—¶å€™æ›´æ¨èç”¨ä¸‹é¢ä»‹ç»çš„ computed API å’Œ storeToRefs API ç­‰æ–¹å¼æ¥è·å–ã€‚

#### ä½¿ç”¨ computed API

ç°åœ¨ state é‡Œå·²ç»æœ‰å®šä¹‰å¥½çš„æ•°æ®äº†ï¼Œä¸‹é¢è¿™æ®µä»£ç æ˜¯åœ¨ Vue ç»„ä»¶é‡Œå¯¼å…¥çš„ Store ï¼Œå¹¶é€šè¿‡è®¡ç®—æ•°æ® `computed` æ‹¿åˆ°é‡Œé¢çš„ `message` æ•°æ®ä¼ ç»™ template ä½¿ç”¨ï¼š

```ts
<script lang="ts">
import { computed, defineComponent } from 'vue'
import { useStore } from '@/stores'

export default defineComponent({
  setup() {
    // åƒ useRouter é‚£æ ·å®šä¹‰ä¸€ä¸ªå˜é‡æ‹¿åˆ°å®ä¾‹
    const store = useStore()

    // é€šè¿‡è®¡ç®—æ‹¿åˆ°é‡Œé¢çš„æ•°æ®
    const message = computed(() => store.message)
    console.log('message', message.value)

    // ä¼ ç»™ template ä½¿ç”¨
    return {
      message,
    }
  },
})
</script>
```

å¦‚æœè¦æ›´æ–°æ•°æ®ï¼š

1. å¯ä»¥é€šè¿‡æå‰å®šä¹‰å¥½çš„ Store Actions æ–¹æ³•è¿›è¡Œæ›´æ–°ã€‚
2. åœ¨å®šä¹‰ computed å˜é‡çš„æ—¶å€™ï¼Œé…ç½®å¥½setterçš„è¡Œä¸ºï¼š
    ```ts
    // å…¶ä»–ä»£ç å’Œä¸Šä¸€ä¸ªä¾‹å­ä¸€æ ·ï¼Œè¿™é‡Œçœç•¥...

    // ä¿®æ”¹ï¼šå®šä¹‰ computed å˜é‡çš„æ—¶å€™é…ç½® getter å’Œ setter
    const message = computed({
        // getter è¿˜æ˜¯è¿”å›æ•°æ®çš„å€¼
        get: () => store.message,
        // é…ç½® setter æ¥å®šä¹‰èµ‹å€¼åçš„è¡Œä¸º
        set(newVal) {
            store.message = newVal
        },
    })

    // æ­¤æ—¶ä¸å†æŠ›å‡º Write operation failed: computed value is readonly çš„è­¦å‘Š
    message.value = 'New Message.'

    // store ä¸Šçš„æ•°æ®å·²æˆåŠŸå˜æˆäº† New Message.
    console.log(store.message)
    ```

#### ä½¿ç”¨ storeToRefs API

è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸º Pinia Stores è®¾è®¡çš„ API ï¼Œç±»ä¼¼äº toRefs ï¼ŒåŒºåˆ«åœ¨äºï¼Œå®ƒä¼šå¿½ç•¥æ‰ Store ä¸Šé¢çš„æ–¹æ³•å’Œéå“åº”æ€§çš„æ•°æ®ï¼Œåªè¿”å› state ä¸Šçš„å“åº”æ€§æ•°æ®ï¼š

```ts
import { defineComponent } from 'vue'
import { useStore } from '@/stores'

// è®°å¾—å¯¼å…¥è¿™ä¸ª API
import { storeToRefs } from 'pinia'

export default defineComponent({
  setup() {
    const store = useStore()

    // é€šè¿‡ storeToRefs æ¥æ‹¿åˆ°å“åº”æ€§çš„ message
    const { message } = storeToRefs(store)
    console.log('message', message.value)

    return {
      message,
    }
  },
})
```

é€šè¿‡è¿™ä¸ªæ–¹å¼æ‹¿åˆ°çš„ message å˜é‡æ˜¯ä¸€ä¸ª Ref ç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥åƒæ™®é€šçš„ ref å˜é‡ä¸€æ ·è¿›è¡Œè¯»å–å’Œèµ‹å€¼ã€‚

```ts
// ç›´æ¥èµ‹å€¼å³å¯
message.value = 'New Message.'

// store ä¸Šçš„æ•°æ®å·²æˆåŠŸå˜æˆäº† New Message.
console.log(store.message)
```

#### ä½¿ç”¨ toRefs API

å¦‚ ä½¿ç”¨ [storeToRefs API](#ä½¿ç”¨-storetorefs-api) éƒ¨åˆ†æ‰€è¯´ï¼Œè¯¥ API æœ¬èº«çš„è®¾è®¡å°±æ˜¯ç±»ä¼¼äº toRefs ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ toRefs æŠŠ state ä¸Šçš„æ•°æ®è½¬æˆ ref å˜é‡ï¼š

```ts
// æ³¨æ„ toRefs æ˜¯ vue çš„ API ï¼Œä¸æ˜¯ Pinia
import { defineComponent, toRefs } from 'vue'
import { useStore } from '@/stores'

export default defineComponent({
  setup() {
    const store = useStore()

    // è·Ÿ storeToRefs æ“ä½œéƒ½ä¸€æ ·ï¼Œåªä¸è¿‡ç”¨ Vue çš„è¿™ä¸ª API æ¥å¤„ç†
    const { message } = toRefs(store)
    console.log('message', message.value)

    return {
      message,
    }
  },
})
```

åƒä¸Šé¢è¿™æ ·ï¼Œå¯¹ store æ‰§è¡Œ toRefs ä¼šæŠŠ store ä¸Šé¢çš„ getters ã€ actions ä¹Ÿä¸€èµ·æå–ï¼Œå¦‚æœåªéœ€è¦æå– state ä¸Šçš„æ•°æ®ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```ts
// åªä¼ å…¥ store.$state
const { message } = toRefs(store.$state)
```

#### ä½¿ç”¨ toRef API

toRef æ˜¯ toRefs çš„å…„å¼Ÿ API ï¼Œä¸€ä¸ªæ˜¯åªè½¬æ¢ä¸€ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯è½¬æ¢æ‰€æœ‰å­—æ®µï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥ç”¨æ¥è½¬æ¢ state æ•°æ®å˜æˆ ref å˜é‡ï¼š

```ts
// æ³¨æ„ toRef æ˜¯ vue çš„ API ï¼Œä¸æ˜¯ Pinia
import { defineComponent, toRef } from 'vue'
import { useStore } from '@/stores'

export default defineComponent({
  setup() {
    const store = useStore()

    // éµå¾ª toRef çš„ç”¨æ³•å³å¯
    const message = toRef(store, 'message')
    console.log('message', message.value)

    return {
      message,
    }
  },
})
```

#### ä½¿ç”¨ actions æ–¹æ³•

Pinia æ‰€æœ‰æ“ä½œéƒ½é›†åˆä¸º action ï¼Œæ— éœ€åŒºåˆ†åŒæ­¥å’Œå¼‚æ­¥ï¼ŒæŒ‰ç…§å¹³æ—¶çš„å‡½æ•°å®šä¹‰å³å¯æ›´æ–° state ï¼Œå…·ä½“æ“ä½œè¯¦è§[ç®¡ç† actions]()ä¸€èŠ‚ã€‚

### æ‰¹é‡æ›´æ–° state

åœ¨ [è·å–å’Œæ›´æ–°state](#è·å–å’Œæ›´æ–°-state) éƒ¨åˆ†è¯´çš„éƒ½æ˜¯å¦‚ä½•ä¿®æ”¹å•ä¸ª state æ•°æ®ï¼Œé‚£ä¹ˆæœ‰æ—¶å€™è¦åŒæ—¶ä¿®æ”¹å¾ˆå¤šä¸ªï¼Œä¼šæ˜¾å¾—æ¯”è¾ƒç¹çã€‚

Pinia ä¹Ÿæä¾›äº†ä¸€ä¸ªÂ `$patch`Â API ç”¨äºåŒæ—¶ä¿®æ”¹å¤šä¸ªæ•°æ®ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š

| **å‚æ•°** | **ç±»å‹** | **è¯­æ³•** |
| :---: | :---: | --- |
| partialState | å¯¹è±¡ / å‡½æ•° | store.$patch(partialState) |

#### ä¼ å…¥ä¸€ä¸ªå¯¹è±¡

å½“å‚æ•°ç±»å‹ä¸ºå¯¹è±¡æ—¶ï¼Œ`key` æ˜¯è¦ä¿®æ”¹çš„ state æ•°æ®åç§°ï¼Œ `value` æ˜¯æ–°çš„å€¼ï¼ˆæ”¯æŒåµŒå¥—ä¼ å€¼ï¼‰ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

```ts
// ç»§ç»­ç”¨å‰é¢çš„æ•°æ®ï¼Œè¿™é‡Œä¼šæ‰“å°å‡ºä¿®æ”¹å‰çš„å€¼
console.log(JSON.stringify(store.$state))
// è¾“å‡º {"message":"Hello World","randomMessages":[]}

/**
 * æ³¨æ„è¿™é‡Œï¼Œä¼ å…¥äº†ä¸€ä¸ªå¯¹è±¡
 */
store.$patch({
  message: 'New Message',
  randomMessages: ['msg1', 'msg2', 'msg3'],
})

// è¿™é‡Œä¼šæ‰“å°å‡ºä¿®æ”¹åçš„å€¼
console.log(JSON.stringify(store.$state))
// è¾“å‡º {"message":"New Message","randomMessages":["msg1","msg2","msg3"]}
```

å¯¹äºç®€å•çš„æ•°æ®ï¼Œç›´æ¥ä¿®æ”¹æˆæ–°å€¼æ˜¯éå¸¸å¥½ç”¨çš„ã€‚

ä½†æœ‰æ—¶å€™å¹¶ä¸å•å•åªæ˜¯ä¿®æ”¹ï¼Œè€Œæ˜¯è¦å¯¹æ•°æ®è¿›è¡Œæ‹¼æ¥ã€è¡¥å……ã€åˆå¹¶ç­‰æ“ä½œï¼Œç›¸å¯¹è€Œè¨€å¼€é”€å°±ä¼šå¾ˆå¤§ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæ›´é€‚åˆ [ä¼ å…¥ä¸€ä¸ªå‡½æ•°](#ä¼ å…¥ä¸€ä¸ªå‡½æ•°) æ¥å¤„ç†ã€‚

#### ä¼ å…¥ä¸€ä¸ªå‡½æ•°

å½“å‚æ•°ç±»å‹ä¸ºå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šæœ‰ä¸€ä¸ªå…¥å‚ `state` ï¼Œæ˜¯å½“å‰å®ä¾‹çš„ state ï¼Œç­‰ä»·äº `store.$state` ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

```ts
// è¿™é‡Œä¼šæ‰“å°å‡ºä¿®æ”¹å‰çš„å€¼
console.log(JSON.stringify(store.$state))
// è¾“å‡º {"message":"Hello World","randomMessages":[]}

/**
 * æ³¨æ„è¿™é‡Œï¼Œè¿™æ¬¡æ˜¯ä¼ å…¥äº†ä¸€ä¸ªå‡½æ•°
 */
store.$patch((state) => {
  state.message = 'New Message'

  // æ•°ç»„æ”¹æˆç”¨è¿½åŠ çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯é‡æ–°èµ‹å€¼
  for (let i = 0; i < 3; i++) {
    state.randomMessages.push(`msg${i + 1}`)
  }
})

// è¿™é‡Œä¼šæ‰“å°å‡ºä¿®æ”¹åçš„å€¼
console.log(JSON.stringify(store.$state))
// è¾“å‡º {"message":"New Message","randomMessages":["msg1","msg2","msg3"]}
```

### å…¨é‡æ›´æ–° state

è™½ç„¶å¯ä»¥å¯¹æ‰€æœ‰æ•°æ®éƒ½æ‰§è¡Œä¸€æ¬¡ â€œè¡¥ä¸æ›´æ–°â€ æ¥è¾¾åˆ° â€œå…¨é‡æ›´æ–°â€ çš„ç›®çš„ï¼Œä½† Pinia ä¹Ÿæä¾›äº†ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ã€‚ä»å‰é¢å¤šæ¬¡æåˆ° state æ•°æ®å¯ä»¥é€šè¿‡ `store.$state` æ¥æ‹¿åˆ°ï¼Œè€Œè¿™ä¸ªå±æ€§æœ¬èº«æ˜¯å¯ä»¥ç›´æ¥èµ‹å€¼çš„ã€‚

state ä¸Šç°åœ¨æœ‰ `message` å’Œ `randomMessages` è¿™ä¸¤ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆè¦å…¨é‡æ›´æ–°ä¸ºæ–°çš„å€¼ï¼Œå°±è¿™ä¹ˆæ“ä½œï¼š

```ts
store.$state = {
  message: 'New Message',
  randomMessages: ['msg1', 'msg2', 'msg3'],
}
```

æ³¨æ„å¿…é¡»éµå¾ª state åŸæœ‰çš„æ•°æ®å’Œå¯¹åº”çš„ç±»å‹ã€‚

### é‡ç½® state

Pinia æä¾›äº†ä¸€ä¸ª `$reset` API æŒ‚åœ¨æ¯ä¸ªå®ä¾‹ä¸Šé¢ï¼Œç”¨äºé‡ç½®æ•´æ£µ state æ ‘ä¸ºåˆå§‹æ•°æ®ï¼š

```ts
// è¿™ä¸ª store æ˜¯ä¸Šé¢å®šä¹‰å¥½çš„å®ä¾‹
store.$reset()
```

å…·ä½“ä¾‹å­ï¼š

```ts
// ä¿®æ”¹æ•°æ®
store.message = 'New Message'
console.log(store.message) // è¾“å‡º New Message

// 3s åé‡ç½®çŠ¶æ€
setTimeout(() => {
  store.$reset()
  console.log(store.message) // è¾“å‡ºæœ€å¼€å§‹çš„ Hello World
}, 3000)
```

### è®¢é˜… state

 Pinia æä¾›äº†ä¸€ä¸ªç”¨äºè®¢é˜… state çš„ `$subscribe` API ã€‚

 #### è®¢é˜… API çš„ TS ç±»å‹

 åœ¨äº†è§£è¿™ä¸ª API çš„ä½¿ç”¨ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹å®ƒçš„ TS ç±»å‹å®šä¹‰ï¼š

 ```ts
// $subscribe éƒ¨åˆ†çš„ TS ç±»å‹
// ...
$subscribe(
  callback: SubscriptionCallback<S>,
  options?: { detached?: boolean } & WatchOptions
): () => void
// ...
 ```

#### æ·»åŠ è®¢é˜…

`$subscribe` API çš„åŠŸèƒ½ç±»ä¼¼äº watch ï¼Œä½†å®ƒåªä¼šåœ¨ state è¢«æ›´æ–°çš„æ—¶å€™æ‰è§¦å‘ä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨ç»„ä»¶è¢«å¸è½½æ—¶åˆ é™¤ï¼ˆå‚è€ƒï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚

ä» [è®¢é˜…APIçš„TSç±»å‹](#è®¢é˜…-api-çš„-ts-ç±»å‹) å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¿…ä¼ çš„ callback å‡½æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é»˜è®¤ç”¨è¿™ä¸ªæ–¹å¼å³å¯ï¼Œä½¿ç”¨ä¾‹å­ï¼š

```ts
// å¯ä»¥åœ¨ state å‡ºç°å˜åŒ–æ—¶ï¼Œæ›´æ–°æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨çš„æ•°æ®
store.$subscribe((mutation, state) => {
  localStorage.setItem('store', JSON.stringify(state))
})
```

è¿™ä¸ª callback é‡Œé¢æœ‰ 2 ä¸ªå…¥å‚ï¼š

| **å…¥å‚** | **ä½œç”¨** |
| :---: | --- |
| mutation | æœ¬æ¬¡äº‹ä»¶çš„ä¸€äº›ä¿¡æ¯ |
| state | å½“å‰å®ä¾‹çš„ state |

å…¶ä¸­ mutation åŒ…å«äº†ä»¥ä¸‹æ•°æ®ï¼š

| **å­—æ®µ** | **å€¼** |
| :---: | --- |
| storeId | å‘å¸ƒæœ¬æ¬¡è®¢é˜…é€šçŸ¥çš„ Pinia å®ä¾‹çš„å”¯ä¸€ IDï¼ˆç”±Â [åˆ›å»º Store](#åˆ›å»º-store)Â æ—¶æŒ‡å®šï¼‰ |
| type | æœ‰ 3 ä¸ªå€¼ï¼šè¿”å›Â `direct`Â ä»£è¡¨ç›´æ¥æ›´æ”¹æ•°æ®ï¼›è¿”å›Â `patch object`Â ä»£è¡¨æ˜¯é€šè¿‡Â [ä¼ å…¥ä¸€ä¸ªå¯¹è±¡](#ä¼ å…¥ä¸€ä¸ªå¯¹è±¡)Â æ›´æ”¹ï¼›è¿”å›Â `patch function`Â åˆ™ä»£è¡¨æ˜¯é€šè¿‡Â [ä¼ å…¥ä¸€ä¸ªå‡½æ•°](#ä¼ å…¥ä¸€ä¸ªå‡½æ•°)Â æ›´æ”¹ |
| events | è§¦å‘æœ¬æ¬¡è®¢é˜…é€šçŸ¥çš„äº‹ä»¶åˆ—è¡¨ |
| payload | é€šè¿‡Â [ä¼ å…¥ä¸€ä¸ªå‡½æ•°](#ä¼ å…¥ä¸€ä¸ªå‡½æ•°)Â æ›´æ”¹æ—¶ï¼Œä¼ é€’è¿›æ¥çš„è·è½½ä¿¡æ¯ï¼Œåªæœ‰Â `type`Â ä¸ºÂ `patch object`Â æ—¶æ‰æœ‰ |

å¦‚æœä¸å¸Œæœ›ç»„ä»¶è¢«å¸è½½æ—¶åˆ é™¤è®¢é˜…ï¼Œå¯ä»¥ä¼ é€’ç¬¬äºŒä¸ªå‚æ•° options ç”¨ä»¥ä¿ç•™è®¢é˜…çŠ¶æ€ï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡ã€‚

å¯ä»¥ç®€å•æŒ‡å®šä¸ºÂ `{ detached: true }`ï¼Œä¹Ÿå¯ä»¥æ­é… watch API çš„é€‰é¡¹ä¸€èµ·ç”¨ï¼š

```ts
store.$subscribe(
  (mutation, state) => {
    // ...
  },
  { detached: true },
)
```

#### ç§»é™¤è®¢é˜…

åœ¨ [æ·»åŠ è®¢é˜…](#æ·»åŠ è®¢é˜…) éƒ¨åˆ†å·²äº†è§£è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç»„ä»¶è¢«å¸è½½æ—¶è®¢é˜…ä¹Ÿä¼šè¢«ä¸€å¹¶ç§»é™¤ï¼Œä½†å¦‚æœä¹‹å‰å¯ç”¨äº† detached é€‰é¡¹ï¼Œå°±éœ€è¦æ‰‹åŠ¨å–æ¶ˆäº†ã€‚å‰é¢åœ¨ [è®¢é˜…APIçš„TSç±»å‹](#è®¢é˜…-api-çš„-ts-ç±»å‹) é‡Œæåˆ°ï¼Œåœ¨å¯ç”¨ $subscribe API ä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªå‡½æ•°ä½œä¸ºè¿”å›å€¼ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç”¨æ¥å–æ¶ˆè¯¥è®¢é˜…ã€‚

```ts
// å®šä¹‰ä¸€ä¸ªé€€è®¢å˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°
const unsubscribe = store.$subscribe(
  (mutation, state) => {
    // ...
  },
  { detached: true },
)

// åœ¨åˆé€‚çš„æ—¶æœŸè°ƒç”¨å®ƒï¼Œå¯ä»¥å–æ¶ˆè¿™ä¸ªè®¢é˜…
unsubscribe()
```

## ç®¡ç† getters

Pinia çš„ `getters` æ˜¯ç”¨æ¥è®¡ç®—æ•°æ®çš„ã€‚

### ç»™ Store æ·»åŠ  getter

#### æ·»åŠ æ™®é€šçš„ getter

ç»§ç»­ç”¨åˆšæ‰çš„ `message` ï¼Œæ¥å®šä¹‰ä¸€ä¸ª Getter ï¼Œç”¨äºè¿”å›ä¸€å¥æ‹¼æ¥å¥½çš„å¥å­ï¼š

```ts
// src/stores/index.ts
import { defineStore } from 'pinia'

export const useStore = defineStore('main', {
  state: () => ({
    message: 'Hello World',
  }),
  // å®šä¹‰ä¸€ä¸ª fullMessage çš„è®¡ç®—æ•°æ®
  getters: {
    fullMessage: (state) => `The message is "${state.message}".`,
  },
  // ...
})
```

#### æ·»åŠ å¼•ç”¨ getter çš„ getter

æœ‰æ—¶å€™å¯èƒ½è¦å¼•ç”¨å¦å¤–ä¸€ä¸ª getter çš„å€¼æ¥è¿”å›æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ä¸èƒ½ç”¨ç®­å¤´å‡½æ•°äº†ï¼Œéœ€è¦å®šä¹‰æˆæ™®é€šå‡½æ•°è€Œä¸æ˜¯ç®­å¤´å‡½æ•°ï¼Œå¹¶åœ¨å‡½æ•°å†…éƒ¨é€šè¿‡Â `this`Â æ¥è°ƒç”¨å½“å‰ Store ä¸Šçš„æ•°æ®å’Œæ–¹æ³•ã€‚ç»§ç»­åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæ·»åŠ å¤šä¸€ä¸ªÂ `emojiMessage`Â çš„ getter ï¼Œåœ¨è¿”å›Â `fullMessage`Â çš„ç»“æœçš„åŒæ—¶ï¼Œæ‹¼æ¥å¤šä¸€ä¸² emoji ï¼š

```ts
export const useStore = defineStore('main', {
  state: () => ({
    message: 'Hello World',
  }),
  getters: {
    fullMessage: (state) => `The message is "${state.message}".`,
    // è¿™ä¸ª getter è¿”å›äº†å¦å¤–ä¸€ä¸ª getter çš„ç»“æœ
    emojiMessage(): string {
      return `ğŸ‰ğŸ‰ğŸ‰ ${this.fullMessage}`
    },
  },
})
```

å¦‚æœåªå†™ JavaScript ï¼Œå¯èƒ½å¯¹è¿™ä¸€æ¡æ‰€è¯´çš„é™åˆ¶è§‰å¾—å¾ˆå¥‡æ€ªï¼Œäº‹å®ä¸Šç”¨ JS å†™ç®­å¤´å‡½æ•°æ¥å¼•ç”¨ç¡®å®ä¸ä¼šæŠ¥é”™ï¼Œä½†å¦‚æœç”¨çš„æ˜¯ TypeScript ï¼Œä¸æŒ‰ç…§è¿™ä¸ªå†™æ³•ï¼Œåœ¨ VSCode æç¤ºå’Œæ‰§è¡Œ TSC æ£€æŸ¥çš„æ—¶å€™éƒ½ä¼šç»™æŠ›å‡ºä¸€æ¡é”™è¯¯ã€‚

å¦å¤–å…³äºæ™®é€šå‡½æ•°çš„ TS è¿”å›ç±»å‹ï¼Œå®˜æ–¹å»ºè®®æ˜¾å¼çš„è¿›è¡Œæ ‡æ³¨ï¼Œå°±åƒè¿™ä¸ªä¾‹å­é‡Œçš„Â `emojiMessage(): string`Â é‡Œçš„Â `: string`Â ã€‚

#### ç»™ getter ä¼ é€’å‚æ•°

getter æœ¬èº«æ˜¯ä¸æ”¯æŒå‚æ•°çš„ï¼Œä½†å’Œ Vuex ä¸€æ ·ï¼Œæ”¯æŒè¿”å›ä¸€ä¸ªå…·å¤‡å…¥å‚çš„å‡½æ•°ï¼Œç”¨æ¥æ»¡è¶³éœ€æ±‚ã€‚

```ts
import { defineStore } from 'pinia'

export const useStore = defineStore('main', {
  state: () => ({
    message: 'Hello World',
  }),
  getters: {
    // å®šä¹‰ä¸€ä¸ªæ¥æ”¶å…¥å‚çš„å‡½æ•°ä½œä¸ºè¿”å›å€¼
    signedMessage: (state) => {
      return (name: string) => `${name} say: "The message is ${state.message}".`
    },
  },
})
```

è°ƒç”¨çš„æ—¶å€™æ˜¯è¿™æ ·ï¼š

```ts
const signedMessage = store.signedMessage('Petter')
console.log('signedMessage', signedMessage)
// Petter say: "The message is Hello World".
```

è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ª getter åªæ˜¯è°ƒç”¨çš„å‡½æ•°çš„ä½œç”¨ï¼Œä¸å†æœ‰ç¼“å­˜ï¼Œå¦‚æœé€šè¿‡å˜é‡å®šä¹‰äº†è¿™ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¹Ÿåªæ˜¯æ™®é€šå˜é‡ï¼Œä¸å…·å¤‡å“åº”æ€§ã€‚

```ts
// é€šè¿‡å˜é‡å®šä¹‰ä¸€ä¸ªå€¼
const signedMessage = store.signedMessage('Petter')
console.log('signedMessage', signedMessage)
// Petter say: "The message is Hello World".

// 2s åæ”¹å˜ message
setTimeout(() => {
  store.message = 'New Message'

  // signedMessage ä¸ä¼šå˜
  console.log('signedMessage', signedMessage)
  // Petter say: "The message is Hello World".

  // å¿…é¡»è¿™æ ·å†æ¬¡æ‰§è¡Œæ‰èƒ½æ‹¿åˆ°æ›´æ–°åçš„å€¼
  console.log('signedMessage', store.signedMessage('Petter'))
  // Petter say: "The message is New Message".
}, 2000)
```

#### è·å–å’Œæ›´æ–° getter

getter å’Œ state éƒ½å±äºæ•°æ®ç®¡ç†ï¼Œè¯»å–å’Œèµ‹å€¼çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œè¯·å‚è€ƒä¸Šæ–¹ [è·å–å’Œæ›´æ–° state](#è·å–å’Œæ›´æ–°-state) ä¸€èŠ‚çš„å†…å®¹ã€‚

## ç®¡ç† actions

Pinia åªéœ€è¦ç”¨ `actions` å°±å¯ä»¥è§£å†³å„ç§æ•°æ®æ“ä½œï¼Œæ— éœ€åƒ Vuex ä¸€æ ·åŒºåˆ†ä¸º `mutations / actions` ä¸¤å¤§ç±»ã€‚

### ç»™ Store æ·»åŠ  action

å¯ä»¥ä¸ºå½“å‰ Store å°è£…ä¸€äº›å¯ä»¥å¼€ç®±å³ç”¨çš„æ–¹æ³•ï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ã€‚

```ts
// src/stores/index.ts
import { defineStore } from 'pinia'

export const useStore = defineStore('main', {
  state: () => ({
    message: 'Hello World',
  }),
  actions: {
    // å¼‚æ­¥æ›´æ–° message
    async updateMessage(newMessage: string): Promise<string> {
      return new Promise((resolve) => {
        setTimeout(() => {
          // è¿™é‡Œçš„ this æ˜¯å½“å‰çš„ Store å®ä¾‹
          this.message = newMessage
          resolve('Async done.')
        }, 3000)
      })
    },
    // åŒæ­¥æ›´æ–° message
    updateMessageSync(newMessage: string): string {
      // è¿™é‡Œçš„ this æ˜¯å½“å‰çš„ Store å®ä¾‹
      this.message = newMessage
      return 'Sync done.'
    },
  },
})
```

åœ¨ action é‡Œï¼Œå¦‚æœè¦è®¿é—®å½“å‰å®ä¾‹çš„ state æˆ–è€… getter ï¼Œåªéœ€è¦é€šè¿‡ `this` å³å¯æ“ä½œï¼Œæ–¹æ³•çš„å…¥å‚å®Œå…¨ä¸å†å— Vuex é‚£æ ·æœ‰å›ºå®šå½¢å¼çš„å›°æ‰°ã€‚

### è°ƒç”¨ action

åœ¨ Pinia ä¸­åªè¦åƒæ™®é€šçš„å‡½æ•°ä¸€æ ·ä½¿ç”¨å³å¯ï¼Œä¸éœ€è¦å’Œ Vuex ä¸€æ ·è°ƒç”¨ commit æˆ–è€… dispatchã€‚

```ts
export default defineComponent({
  setup() {
    const store = useStore()
    const { message } = storeToRefs(store)

    // ç«‹å³æ‰§è¡Œ
    console.log(store.updateMessageSync('New message by sync.'))

    // 3s åæ‰§è¡Œ
    store.updateMessage('New message by async.').then((res) => console.log(res))

    return {
      message,
    }
  },
})
```

## æ·»åŠ å¤šä¸ª Store

åˆ°è¿™é‡Œï¼Œå¯¹å•ä¸ª Store çš„é…ç½®å’Œè°ƒç”¨ç›¸ä¿¡éƒ½å·²ç»æ¸…æ¥šäº†ï¼Œå®é™…é¡¹ç›®ä¸­ä¼šæ¶‰åŠåˆ°å¾ˆå¤šæ•°æ®æ“ä½œï¼Œè¿˜å¯ä»¥ç”¨å¤šä¸ª Store æ¥ç»´æŠ¤ä¸åŒéœ€æ±‚æ¨¡å—çš„æ•°æ®çŠ¶æ€ã€‚

è¿™ä¸€ç‚¹å’Œ Vuex çš„ Module æ¯”è¾ƒç›¸ä¼¼ï¼Œç›®çš„éƒ½æ˜¯ä¸ºäº†é¿å…çŠ¶æ€æ ‘è¿‡äºè‡ƒè‚¿ï¼Œä½†ç”¨èµ·æ¥ä¼šæ›´ä¸ºç®€å•ã€‚

### ç›®å½•ç»“æ„å»ºè®®

å»ºè®®ç»Ÿä¸€å­˜æ”¾åœ¨ `src/stores` ä¸‹é¢ç®¡ç†ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦è¿›è¡Œå‘½åï¼Œæ¯”å¦‚ `user` å°±ç”¨æ¥ç®¡ç†ç™»å½•ç”¨æˆ·ç›¸å…³çš„çŠ¶æ€æ•°æ®ã€‚

```bash
src
â””â”€stores
  â”‚ # å…¥å£æ–‡ä»¶
  â”œâ”€index.ts
  â”‚ # å¤šä¸ª store
  â”œâ”€user.ts
  â”œâ”€game.ts
  â””â”€news.ts
```

é‡Œé¢æš´éœ²çš„æ–¹æ³•å°±ç»Ÿä¸€ä»¥Â `use`Â å¼€å¤´åŠ ä¸Šæ–‡ä»¶åï¼Œå¹¶ä»¥Â `Store`Â ç»“å°¾ï¼Œä½œä¸ºå°é©¼å³°å†™æ³•ï¼Œæ¯”å¦‚Â `user`Â è¿™ä¸ª Store æ–‡ä»¶é‡Œé¢å¯¼å‡ºçš„å‡½æ•°åå°±æ˜¯ï¼š

```ts
// src/stores/user.ts
export const useUserStore = defineStore('user', {
  // ...
})
```

ç„¶åä»¥Â `index.ts`Â é‡Œä½œä¸ºç»Ÿä¸€çš„å…¥å£æ–‡ä»¶ï¼ŒÂ `index.ts`Â é‡Œçš„ä»£ç å†™ä¸ºï¼š

```ts
export * from './user'
export * from './game'
export * from './news'
```

è¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦ä» `@/stores` é‡Œå¯¼å…¥å³å¯ï¼Œæ— éœ€å†™å®Œæ•´çš„è·¯å¾„ï¼Œä¾‹å¦‚åªéœ€è¦è¿™æ ·ï¼š`import { useUserStore } from '@/stores'`ï¼Œè€Œæ— éœ€è¿™æ ·ï¼š`import { useUserStore } from '@/stores/user'`ã€‚

### åœ¨ Vue ç»„ä»¶ / TS æ–‡ä»¶é‡Œä½¿ç”¨

è¿™é‡Œä»¥ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¸šåŠ¡åœºæ™¯ä¸¾ä¾‹ï¼Œå¸Œæœ›èƒ½å¤Ÿæ–¹ä¾¿çš„ç†è§£å¦‚ä½•åŒæ—¶ä½¿ç”¨å¤šä¸ª Store ã€‚

å‡è®¾ç›®å‰æœ‰ä¸€ä¸ª `userStore` æ˜¯ç®¡ç†å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œ `gameStore` æ˜¯ç®¡ç†æ¸¸æˆçš„ä¿¡æ¯ï¼Œè€Œ â€œä¸ªäººä¸­å¿ƒâ€ è¿™ä¸ªé¡µé¢éœ€è¦å±•ç¤º â€œç”¨æˆ·ä¿¡æ¯â€ ï¼Œä»¥åŠ â€œè¯¥ç”¨æˆ·ç»‘å®šçš„æ¸¸æˆä¿¡æ¯â€ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿™æ ·ï¼š

```ts
import { defineComponent, onMounted, ref } from 'vue'
import { storeToRefs } from 'pinia'
// è¿™é‡Œå¯¼å…¥è¦ç”¨åˆ°çš„ Store
import { useUserStore, useGameStore } from '@/stores'
import type { GameItem } from '@/types'

export default defineComponent({
  setup() {
    // å…ˆä» userStore è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå·²ç»ç™»å½•è¿‡ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‹¿åˆ°ï¼‰
    const userStore = useUserStore()
    const { userId, userName } = storeToRefs(userStore)

    // ä½¿ç”¨ gameStore é‡Œçš„æ–¹æ³•ï¼Œä¼ å…¥ç”¨æˆ· ID å»æŸ¥è¯¢ç”¨æˆ·çš„æ¸¸æˆåˆ—è¡¨
    const gameStore = useGameStore()
    const gameList = ref<GameItem[]>([])
    onMounted(async () => {
      gameList.value = await gameStore.queryGameList(userId.value)
    })

    return {
      userId,
      userName,
      gameList,
    }
  },
})
```

åˆ‡è®°æ¯ä¸ª Store çš„ ID å¿…é¡»ä¸åŒï¼Œå¦‚æœ ID é‡å¤ï¼Œåœ¨åŒä¸€ä¸ª Vue ç»„ä»¶ / TS æ–‡ä»¶é‡Œå®šä¹‰ Store å®ä¾‹å˜é‡çš„æ—¶å€™ï¼Œä¼šä»¥å…ˆå®šä¹‰çš„ä¸ºæœ‰æ•ˆå€¼ï¼Œåç»­å®šä¹‰çš„ä¼šå’Œå‰é¢ä¸€æ ·ã€‚

### Store ä¹‹é—´äº’ç›¸å¼•ç”¨

å¦‚æœåœ¨å®šä¹‰ä¸€ä¸ª Store çš„æ—¶å€™ï¼Œè¦å¼•ç”¨å¦å¤–ä¸€ä¸ª Store çš„æ•°æ®ï¼Œä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œå›åˆ°é‚£ä¸ª message çš„ä¾‹å­ï¼Œæ·»åŠ ä¸€ä¸ª getter ï¼Œå®ƒä¼šè¿”å›ä¸€å¥é—®å€™è¯­æ¬¢è¿ç”¨æˆ·ï¼š

```ts
// src/stores/message.ts
import { defineStore } from 'pinia'

// å¯¼å…¥ç”¨æˆ·ä¿¡æ¯çš„ Store å¹¶å¯ç”¨å®ƒ
import { useUserStore } from './user'
const userStore = useUserStore()

export const useMessageStore = defineStore('message', {
  state: () => ({
    message: 'Hello World',
  }),
  getters: {
    // è¿™é‡Œå°±å¯ä»¥ç›´æ¥å¼•ç”¨ userStore ä¸Šé¢çš„æ•°æ®äº†
    greeting: () => `Welcome, ${userStore.userName}!`,
  },
})
```

å‡è®¾ç°åœ¨ `userName` æ˜¯ Petter ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°ä¸€å¥å¯¹ Petter çš„é—®å€™ï¼š

```ts
const messageStore = useMessageStore()
console.log(messageStore.greeting) // Welcome, Petter!
```

## ä¸“å±æ’ä»¶çš„ä½¿ç”¨

Pinia æ‹¥æœ‰éå¸¸çµæ´»çš„å¯æ‰©å±•æ€§ï¼Œæœ‰ä¸“å±æ’ä»¶å¯ä»¥å¼€ç®±å³ç”¨æ»¡è¶³æ›´å¤šçš„éœ€æ±‚åœºæ™¯ã€‚

### å¦‚ä½•æŸ¥æ‰¾æ’ä»¶

æ’ä»¶æœ‰ç»Ÿä¸€çš„å‘½åæ ¼å¼ `pinia-plugin-*` ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ npmjs ä¸Šæœç´¢è¿™ä¸ªå…³é”®è¯æ¥æŸ¥è¯¢ç›®å‰æœ‰å“ªäº›æ’ä»¶å·²å‘å¸ƒã€‚

ç‚¹å‡»æŸ¥è¯¢ï¼š[pinia-plugin - npmjs](https://www.npmjs.com/search?q=pinia-plugin)

### å¦‚ä½•ä½¿ç”¨æ’ä»¶

è¿™é‡Œä»¥ pinia-plugin-persistedstate ä¸ºä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ªè®©æ•°æ®æŒä¹…åŒ–å­˜å‚¨çš„ Pinia æ’ä»¶ã€‚æ’ä»¶ä¹Ÿæ˜¯ç‹¬ç«‹çš„ npm åŒ…ï¼Œéœ€è¦å…ˆå®‰è£…ï¼Œå†æ¿€æ´»ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ã€‚

æ¿€æ´»æ–¹æ³•ä¼šæ¶‰åŠåˆ° Pinia çš„åˆå§‹åŒ–è¿‡ç¨‹è°ƒæ•´ï¼Œè¿™é‡Œä¸å±€é™äºæŸä¸€ä¸ªæ’ä»¶ï¼Œé€šç”¨çš„æ’ä»¶ç”¨æ³•å¦‚ä¸‹(è¯·ç•™æ„ä»£ç æ³¨é‡Š)ï¼š

```ts
// src/main.ts
import { createApp } from 'vue'
import App from '@/App.vue'
import { createPinia } from 'pinia' // å¯¼å…¥ Pinia
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate' // å¯¼å…¥ Pinia æ’ä»¶

const pinia = createPinia() // åˆå§‹åŒ– Pinia
pinia.use(piniaPluginPersistedstate) // æ¿€æ´» Pinia æ’ä»¶

createApp(App)
  .use(pinia) // å¯ç”¨ Pinia ï¼Œè¿™ä¸€æ¬¡æ˜¯åŒ…å«äº†æ’ä»¶çš„ Pinia å®ä¾‹
  .mount('#app')
```

#### ä½¿ç”¨å‰

Pinia é»˜è®¤åœ¨é¡µé¢åˆ·æ–°æ—¶ä¼šä¸¢å¤±å½“å‰å˜æ›´çš„æ•°æ®ï¼Œæ²¡æœ‰åœ¨æœ¬åœ°åšæŒä¹…åŒ–è®°å½•ï¼š

```ts
// å…¶ä»–ä»£ç çœç•¥
const store = useMessageStore()

// å‡è®¾åˆå§‹å€¼æ˜¯ Hello World
setTimeout(() => {
  // 2s åå˜æˆ Hello World!
  store.message = store.message + '!'
}, 2000)

// é¡µé¢åˆ·æ–°ååˆå˜å›äº† Hello World
```

#### ä½¿ç”¨å

æŒ‰ç…§ persistedstate æ’ä»¶çš„æ–‡æ¡£è¯´æ˜ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ª Store å¯ç”¨å®ƒï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ª `persist: true` çš„é€‰é¡¹å³å¯å¼€å¯ï¼š

```ts
// src/stores/message.ts
import { defineStore } from 'pinia'
import { useUserStore } from './user'

const userStore = useUserStore()

export const useMessageStore = defineStore('message', {
  state: () => ({
    message: 'Hello World',
  }),
  getters: {
    greeting: () => `Welcome, ${userStore.userName}`,
  },
  // è¿™æ˜¯æŒ‰ç…§æ’ä»¶çš„æ–‡æ¡£ï¼Œåœ¨å®ä¾‹ä¸Šå¯ç”¨äº†è¯¥æ’ä»¶ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯æ’ä»¶ç‰¹æœ‰çš„
  persist: true,
})
```

å›åˆ°çš„é¡µé¢ï¼Œç°åœ¨è¿™ä¸ª Store å…·å¤‡äº†æŒä¹…åŒ–è®°å¿†çš„åŠŸèƒ½äº†ï¼Œå®ƒä¼šä» localStorage è¯»å–åŸæ¥çš„æ•°æ®ä½œä¸ºåˆå§‹å€¼ï¼Œæ¯ä¸€æ¬¡å˜åŒ–åä¹Ÿä¼šå°†å…¶å†™å…¥ localStorage è¿›è¡Œè®°å¿†å­˜å‚¨ã€‚

```ts
// å…¶ä»–ä»£ç çœç•¥
const store = useMessageStore()

// å‡è®¾åˆå§‹å€¼æ˜¯ Hello World
setTimeout(() => {
  // 2s åå˜æˆ Hello World!
  store.message = store.message + '!'
}, 2000)

// é¡µé¢åˆ·æ–°åå˜æˆäº† Hello World!!
// å†æ¬¡åˆ·æ–°åå˜æˆäº† Hello World!!!
// å†æ¬¡åˆ·æ–°åå˜æˆäº† Hello World!!!!
```

å¯ä»¥åœ¨æµè§ˆå™¨æŸ¥çœ‹åˆ° localStorage çš„å­˜å‚¨å˜åŒ–ï¼Œä»¥ Chrome æµè§ˆå™¨ä¸ºä¾‹ï¼ŒæŒ‰ F12 ï¼Œæ‰“å¼€ Application é¢æ¿ï¼Œé€‰æ‹© Local Storage ï¼Œå¯ä»¥çœ‹åˆ°ä»¥å½“å‰ Store ID ä¸º Key çš„å­˜å‚¨æ•°æ®ã€‚è¿™æ˜¯å…¶ä¸­ä¸€ä¸ªæ’ä»¶ä½¿ç”¨çš„ä¾‹å­ï¼Œæ›´å¤šçš„ç”¨æ³•è¯·æ ¹æ®è‡ªå·±é€‰æ‹©çš„æ’ä»¶çš„ README è¯´æ˜æ“ä½œã€‚